/*!CK:249540449!*//*1380157120,178592025*/

if (self.CavalryLogger) { CavalryLogger.start_js(["qTp4U"]); }

__d("ComposerPublishTrackingStory",["Event","ge","reportData","DOMQuery"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ge'),i=b('reportData'),j=b('DOMQuery');f.init=function(k){g.listen(k,'submit',function(){var l=h('home_stream');if(!l)return;var m=j.scry(l,'.uiStreamStory')[0];if(m&&m.getAttribute('data-ft')){var n=JSON.parse(m.getAttribute('data-ft'));if(!(("mf_story_key" in n)&&("qid" in n)))return;var o={mf_story_key:n.mf_story_key,qid:n.qid};i("compose",{ft:o});}});};});
__d("ComposerXAttachmentUtils",["CSS","DataStore","DOMQuery","Focus","Input","PageTransitions","Run","StickyPlaceholderInput","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOMQuery'),j=b('Focus'),k=b('Input'),l=b('PageTransitions'),m=b('Run'),n=b('StickyPlaceholderInput'),o=b('tx'),p='composer_fixed_placeholder';function q(s,t){if(!h.get(s.element,p,false))s.instance.setPlaceholder(t);}var r={initMentions:function(s,t){q(s,t);var u=i.find(s.element,'textarea.input');j.set(u);},setStickyPlaceholderForMentions:function(s,t){if(i.contains(s.element,document.activeElement)&&g.hasClass(document.activeElement,'DOMControl_placeholder'))document.activeElement.blur();q(s,t);},setPlaceholderIsFixed:function(s,t){h.set(s.element,p,!!t);},setStickyPlaceholderForTypeahead:function(s,t){var u=i.find(s,'.textInput');n.setPlaceholderText(u,t);},registerInputForLeaveWarning:function(s){m.onBeforeUnload(function(){var t=l.getNextURI();if(t.getQueryData().hasOwnProperty('theater'))return;if(a.Dialog&&a.Dialog.getCurrent())return;if(s.offsetParent!==null&&!k.isEmpty(s))return "You haven't finished your post yet. Do you want to leave without finishing?";});}};e.exports=r;});
__d("OnlyMeLoggingConstants",[],function(a,b,c,d,e,f){e.exports={ONLY_ME_IMPRESSION:'only_me_impression',ONLY_ME_CONVERSION:'only_me_conversion'};});
__d("EveryoneLoggingConstants",[],function(a,b,c,d,e,f){e.exports={EVERYONE_IMPRESSION:'everyone_impression',EVERYONE_CONVERSION:'everyone_conversion'};});
__d("PrivacyConst",[],function(a,b,c,d,e,f){var g={FRIENDS_PLUS_GAMER_FRIENDS:128,FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0},h={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0},i={NONE:0,TAGGEES:1,FRIENDS_OF_TAGGEES:2},j={BaseValue:g,FriendsValue:h,TagExpansion:i};e.exports=j;});
__d("XPrivacyRemindersImpressionLoggingControllerURIBuilder",["XControllerURIBuilder","copyProperties"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder'),h=b('copyProperties'),i={path:"\/privacy\/reminders\/log_imp\/",paramDefinitions:{type:{type:"String",required:true}}};function j(){g.call(this,i.path,i.paramDefinitions);return this;}h(j.prototype,g.prototype);e.exports=j;});
__d("ComposerXBootloadStatusAttachment",["function-extensions","Arbiter","AsyncRequest","Bootloader","ComposerXAttachment","ComposerXController","ComposerXDragDrop","ComposerXStore","CSS","DOM","DOMQuery","Event","Focus","OnlyMeLoggingConstants","EveryoneLoggingConstants","Parent","PlaceholderListener","PrivacyConst","SelectorDeprecated","URI","copyProperties","csx","cx","requestAnimationFrame","XPrivacyRemindersImpressionLoggingControllerURIBuilder"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Bootloader'),j=b('ComposerXAttachment'),k=b('ComposerXController'),l=b('ComposerXDragDrop'),m=b('ComposerXStore'),n=b('CSS'),o=b('DOM'),p=b('DOMQuery'),q=b('Event'),r=b('Focus'),s=b('OnlyMeLoggingConstants'),t=b('EveryoneLoggingConstants'),u=b('Parent'),v=b('PlaceholderListener'),w=b('PrivacyConst'),x=b('SelectorDeprecated'),y=b('URI'),z=b('copyProperties'),aa=b('csx'),ba=b('cx'),ca=b('requestAnimationFrame'),da=b('XPrivacyRemindersImpressionLoggingControllerURIBuilder'),ea={only_me:{PRIVACY_CONSTANT:w.BaseValue.SELF,LOG_IMPRESSION:s.ONLY_ME_IMPRESSION,LOG_CONVERSION:s.ONLY_ME_CONVERSION},everyone:{PRIVACY_CONSTANT:w.BaseValue.EVERYONE,LOG_IMPRESSION:t.EVERYONE_IMPRESSION,LOG_CONVERSION:t.EVERYONE_CONVERSION}},fa={};for(var ga in j)if(j.hasOwnProperty(ga))ia[ga]=j[ga];var ha=j===null?null:j.prototype;ia.prototype=Object.create(ha);ia.prototype.constructor=ia;ia.__superConstructor__=j;function ia(ja,ka){j.call(this);this._root=ja;this._config=ka;this._privacyReminders={};this._onSelectorChange=this._onSelectorChange.bind(this);}ia.prototype.getRoot=function(){return this._root;};ia.prototype.initWithComponents=function(ja){fa[this._composerID]=this;this._attachmentIsActive=true;var ka=p.find(this.getComponent('maininput').element,'textarea.input'),la=p.find(u.byClass(this.getRoot(),"_119"),'li.'+this.attachmentClassName);if(this._fullVersion){this._fullInitWithComponents();}else if(!this._bootloading)if(p.contains(this._root,document.activeElement)){this._onInitialFocus();}else{this._focusListener=q.listen(ka,'focus',this._onInitialFocus.bind(this));this._clickListener=q.listen(la,'click',function(){r.set(ka);}.bind(this));}this._dragEnterHandler=g.subscribe('dragenter',function(ma,na){if(na.element==this._root){var oa=na.event.dataTransfer.items,pa;if(oa)pa=l.filterImages(oa);if(pa&&pa.length>0){r.set(ka);}else{var qa=u.byClass(this._root,'focus_target');v.expandInput(qa);if(!this._bootloading&&!this._fullVersion)this._onInitialFocus();}}}.bind(this));this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);if(!ja)r.set(ka);if(this._config.plus_version){this._dragdrop=new l(this._root,this._composerID,this._config.targetID);this._dragdrop.enableURLDropping();}};ia.prototype._fullInitWithComponents=function(){i.loadModules(['ComposerXPrivacyWidgetTags','URLScraper','URI'],function(ja,ka,la){this._tagger.init(this);this._privacyWidgetTags=new ja(this);var ma=p.find(this.getComponent('maininput').element,'textarea.input');if(!this._scraper){this._scraper=new ka(ma);this._scraper.subscribe('match',function(na,oa){var pa=this._getScraperEndpoint();pa.addQueryData({scrape_url:encodeURIComponent(oa.url)});k.getAttachment(this._root,pa.toString());}.bind(this));}this._scraper.enable();this._scraper.check();}.bind(this));Object.keys(this._privacyReminders).forEach(this._showPrivacyReminder,this);if(this._setEveryonePrivacyImpression)this._showPrivacyReminder('everyone');x.subscribe('select',this._onSelectorChange);};ia.prototype._showPrivacyReminder=function(ja){var ka=this,la=this._privacyReminders[ja],ma=ea[ja],na=this.getComponent('mainprivacywidget').element,oa=x.getValue(na);if(!la||!la.dialog||la.shown){if(parseInt(oa,10)===w.BaseValue.EVERYONE&&this._setEveryonePrivacyImpression){this._sendSetEveryonePrivacyImpression();this._setEveryonePrivacyImpression=false;}return;}if(parseInt(oa,10)!==ma.PRIVACY_CONSTANT)return;la.dialog.setContext(this.getComponent('mainprivacywidget').element).show();la.shown=true;var pa=(new da()).setString('type',ma.LOG_IMPRESSION).getURI();new h(pa).send();var qa=function(event){var ra=n.hasClass(event.target,'layerConfirm')||p.scry(event.target,'^.layerConfirm').length===1,sa=n.hasClass(event.target,'layerButton')||p.scry(event.target,'^.layerButton').length===1;if(ra)return;new h('/ajax/privacy/reminders/dismiss').setData({type:ja,hide:sa}).send();la.events.forEach(function(ta){ta.remove();});la.events=[];la.dialog.hide();if(sa)ca(function(){x.toggle(p.scry(ka.getComponent('mainprivacywidget').element,'.uiSelector')[0]);});};la.conversionListener=x.subscribe('select',function(ra,sa){if(sa.selector==na.firstChild){var ta=x.getValue(sa.option);if(ta!==String(ma.PRIVACY_CONSTANT)){var ua=(new da()).setString('type',ma.LOG_CONVERSION).getURI();new h(ua).send();x.unsubscribe(la.conversionListener);la.conversionListener=null;}}});la.events=[q.listen(la.dialog.getContent(),'click',qa),q.listen(la.dialog.getContext(),'click',qa)];};ia.prototype._onSelectorChange=function(ja,ka){var la=this.getComponent('mainprivacywidget').element;if(ka.selector===la.firstChild)setTimeout(function(){this._showPrivacyReminder('everyone');}.bind(this));};ia.prototype.cleanup=function(){this._attachmentIsActive=false;if(this._focusListener){this._focusListener.remove();this._focusListener=null;}if(this._clickListener){this._clickListener.remove();this._clickListener=null;}Object.keys(ea).forEach(function(ja){var ka=this._privacyReminders[ja];if(ka&&ka.dialog&&ka.shown){ka.dialog.hide();ka.events.forEach(function(la){la.remove();});ka.events=[];ka.conversionListener&&x.unsubscribe(ka.conversionListener);ka.conversionListener=null;}}.bind(this));if(this._dragdrop){this._dragdrop.deactivate();this._dragdrop=null;}if(this._fullVersion){this._tagger.cleanup();this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._scraper.disable();}if(this._dragEnterHandler){this._dragEnterHandler.unsubscribe();this._dragEnterHandler=null;}};ia.prototype.reset=function(){var ja=u.byClass(this._root,"child_was_focused");if(ja)n.removeClass(ja,"child_was_focused");if(this._tagger)this._tagger.reset();this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);};ia.prototype.canSwitchAway=function(){return !u.byClass(this._root,'async_saving');};ia.prototype.setBootloadedContent=function(ja){this._setEveryonePrivacyImpression=!!ja.set_everyone_privacy_impression;Object.keys(ea).forEach(function(la){var ma=ja[la+'_privacy_reminder'];if(ma)this._privacyReminders[la]={dialog:ma};}.bind(this));var ka=ja.placeholders.map(function(la){return la.component_name;});m.waitForComponents(this._composerID,ka,function(){var la=p.find(this._root,"._3-6"),ma=p.find(this._root,"._3-7");o.setContent(la,ja.markup.tagger_content);o.setContent(ma,ja.markup.tagger_icons);k.addPlaceholders(this._root,this,ja.placeholders);this._tagger=ja.tagger;this._fullVersion=true;if(this._attachmentIsActive){if(this._focusListener){this._focusListener.remove();this._focusListener=null;}this._fullInitWithComponents();}}.bind(this));};ia.prototype._getScraperEndpoint=function(){return y('/ajax/composerx/attachment/link/scraper/');};ia.prototype._onInitialFocus=function(){g.inform('composer/focus');k.getEndpoint(this._root,'/ajax/composerx/attachment/status/bootload/',true);this._bootloading=true;};ia.prototype.allowOGTagPreview=function(){return true;};ia.prototype._sendSetEveryonePrivacyImpression=function(){new h('/ajax/privacy/reminders/set_everyone_privacy_impression').send();};ia.setBootloadedContent=function(ja,ka){var la=fa[ja];if(la)la.setBootloadedContent.call(la,ka);};z(ia.prototype,{_attachmentIsActive:false,_bootloading:false,_fullVersion:false,_focusListener:null,_privacyWidgetTags:null,_scraper:null,_dragdrop:null,attachmentClassName:"_4j"});e.exports=ia;});
__d("ComposerXMentionsInputReset",["DOMQuery","Input"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('Input');function i(j){var k=g.scry(j.element,'textarea.input')[0];j.instance.reset();h.reset(k);}e.exports=i;});
__d("ComposerXOGTaggerIconReset",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){g.removeClass(j.element,"_4-jh");g.removeClass(j.element,"_509o");}e.exports=i;});
__d("ComposerXPrivacyWidgetReset",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter');function h(i){g.inform('Composer/changedtags',{withTags:[],mention:{},eventTag:false});}e.exports=h;});
__d("ComposerXTaggerIconReset",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){g.removeClass(j.element,"_1dsa");g.removeClass(j.element,"_1dsb");g.removeClass(j.element,"_509o");}e.exports=i;});
__d("AudienceSelectorTags",[],function(a,b,c,d,e,f){var g={},h={hasTags:function(i){return g.hasOwnProperty(i);},setHasTags:function(i){if(i)g[i]=true;}};e.exports=h;});
__d("DynamicIconSelector",["Button","CSS","DOM","SelectorDeprecated"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('SelectorDeprecated'),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("PrivacySelectorOption",["Arbiter","AudienceSelectorTags","CSS","DOM","DynamicIconSelector","Env","Parent","PrivacyConst","SelectorDeprecated","copyProperties","csx","fbt","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AudienceSelectorTags'),i=b('CSS'),j=b('DOM'),k=b('DynamicIconSelector'),l=b('Env'),m=b('Parent'),n=b('PrivacyConst'),o=b('SelectorDeprecated'),p=b('copyProperties'),q=b('csx'),r=b('fbt'),s=b('tx');function t(u,v){if(!u)throw new Error("there's no DOM option. Config data: ",v);this._elem=u;this._selector=m.byClass(this._elem,'audienceSelector');if(!this._selector)return;this._priv_base_val=v.priv_base_val;this._audienceCount=v.audience_count||"";this._hasRestricted=v.has_restricted||false;this._isCustom=v.is_custom||false;this._includedAudience=v.included||"";this._excludedAudience=v.excluded||"";this._tagExpansionBehavior=v.tag_expansion_behavior||n.TagExpansion.NONE;this._plusLabel=j.scry(u,'.plusLabel')[0];this._audienceCountLabel=j.scry(u,'.audienceCountLabel')[0];this._taggedIDs=[];this._tags=[];this._hasEvent=false;this._recalculateTooltipAndLabel();this._updateOptionCountLabel();this._updateSelector();g.subscribe('Composer/changedtags',function(w,x){var y=i.hasClass(this._selector,'composerAudienceSelector');if(!this._getChangedData()||!y)return;var z=this._hasEvent;this._hasEvent=!!x.eventTag;this._tags=x.withTags.map(function(da){return da.getText();});this._taggedIDs=x.withTags.map(function(da){return da.getValue();});for(var aa in x.mention)if(x.mention[aa].type=='user'&&x.mention[aa].uid!=l.user){this._tags.push(x.mention[aa].text);this._taggedIDs.push(x.mention[aa].uid);}else if(x.mention[aa].type=='event')this._hasEvent=true;if(this._hasEvent&&z!=this._hasEvent)this._eventTagChanged();var ba=j.scry(document.body,"._5l7q")[0];ba&&!!this._taggedIDs.length&&i.hide(ba);this._updateOptionCountLabel();var ca=this._recalculateTooltipAndLabel();if(ca&&o.isOptionSelected(this._elem)){this._updateSelector();g.inform('SelectedPrivacyOption/changed',this._getChangedData());}}.bind(this));o.listen(this._selector,'change',this._updateSelector.bind(this));}p(t.prototype,{updateOption:function(u,v,w,x,y){this._priv_base_val=u;this._includedAudience=v;this._excludedAudience=w;this._tagExpansionBehavior=x;this._audienceCount=y;this._recalculateTooltipAndLabel();this._updateOptionCountLabel();return {label:this._label,tooltip:this._tooltip};},_recalculateTooltipAndLabel:function(){var u=this._label;this._label=this._getNewSelectorLabel();var v=this._tooltip;this._tooltip=this._getNewTooltip();return (v!=this._tooltip)||(u!=this._label);},_getNewTooltip:function(){if(this._isCustom)return this._recalcCustomTooltip();switch(this._priv_base_val){case n.FriendsValue.ALL_FRIENDS:return this._recalcFriendsTooltip();case n.FriendsValue.FRIENDS_MINUS_ACQUAINTANCES:return this._recalcFriendsMinusTooltip();case n.FriendsValue.SELF:var u=this._getTagExpansionText();return u?u:this._getIncludedAudience();default:return this._recalcCustomTooltip();}},_getNewSelectorLabel:function(){var u=this._elem.getAttribute('data-label').replace(/\(.*\)/,"");if(this._showAudienceCount()){var v=' ('+this._audienceCount+')';u+=v;}if(this._isTagExpanded())u+=' (+)';return u;},_updateOptionCountLabel:function(){if(this._audienceCountLabel){if(this._showAudienceCount()){var u=' ('+this._audienceCount+')';j.setContent(this._audienceCountLabel,u);}i.conditionShow(this._audienceCountLabel,this._showAudienceCount());}this._plusLabel&&i.conditionShow(this._plusLabel,this._isTagExpanded());},_eventTagChanged:function(){if(o.isOptionSelected(this._elem)){var u=this._getChangedData();u.privacy=o.getValue(this._selector);g.inform('EventTagged/changed',u);}},_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:this._priv_base_val};},_showAudienceCount:function(){return (this._audienceCountLabel&&this._audienceCount&&this._audienceCount.length>0);},_isTagExpanded:function(){var u=this._getTagExpansionBehavior(),v=!!this._taggedIDs.length||this._alreadyHasTags();return (v&&u!=n.TagExpansion.NONE)||(!!this._hasEvent&&u==n.TagExpansion.FRIENDS_OF_TAGGEES);},_alreadyHasTags:function(){var u=j.scry(this._selector,'*[data-oid]')[0];u=u&&u.getAttribute('data-oid');return u&&h.hasTags(u);},_updateSelector:function(){if(o.isOptionSelected(this._elem)){var u=i.hasClass(this._selector,'composerAudienceSelector');u&&o.setButtonLabel(this._selector,this._label);o.setButtonTooltip(this._selector,this._tooltip);k.swapIcon(this._selector);return false;}return true;},_isSharedAlbum:function(){var u=j.scry(this._selector,'*[data-shared-album]')[0];return u&&u.getAttribute('data-shared-album');},_getTagExpansionBehavior:function(){if(this._tagExpansionBehavior)return this._tagExpansionBehavior;var u=this._priv_base_val===n.FriendsValue.SELF,v=this._priv_base_val===n.FriendsValue.EVERYONE;if((u&&this._isSharedAlbum())||v){return n.TagExpansion.NONE;}else if(this._priv_base_val<n.FriendsValue.ALL_FRIENDS)return n.TagExpansion.TAGGEES;return n.TagExpansion.FRIENDS_OF_TAGGEES;},_getTagExpansionText:function(){var u=this._getTagExpansionBehavior();if(!!this._taggedIDs.length||this._alreadyHasTags()){if(u==n.TagExpansion.FRIENDS_OF_TAGGEES){if(this._hasEvent)return "friends of anyone tagged, event guests";return "friends of anyone tagged";}else if(u==n.TagExpansion.TAGGEES)return "Anyone tagged";return '';}if(this._hasEvent&&u==n.TagExpansion.FRIENDS_OF_TAGGEES)return "event guests";return '';},_getIncludedAudience:function(){if(this._includedAudience)return this._includedAudience;var u=this._priv_base_val===n.FriendsValue.SELF;if(u&&!this._isSharedAlbum())return "Only Me";return this._elem.getAttribute('data-label');},_getCombinedSentence:function(u,v){if(!v)return u;return r._("{list of people who can see this}; Except: {list of people who cannot see this}",[r.param("list of people who can see this",u),r.param("list of people who cannot see this",v)]);},_recalcFriendsTooltip:function(){var u=this._hasEvent,v=this._tags.length;if(v>2){if(u){return this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Restricted":"Your friends, friends of anyone tagged and event guests";}else return this._hasRestricted?"Your friends and friends of anyone tagged; Except: Restricted":"Your friends and friends of anyone tagged";}else if(v==2){if(u){if(this._hasRestricted){return "Your friends, friends of anyone tagged and event guests; Except: Restricted";}else return "Your friends, friends of anyone tagged and event guests";}else if(this._hasRestricted){return s._("Your friends, {user}'s friends and {user2}'s friends; Except: Restricted ",{user:this._tags[0],user2:this._tags[1]});}else return s._("Your friends, {user}'s friends and {user2}'s friends",{user:this._tags[0],user2:this._tags[1]});}else if(v==1){if(u){if(this._hasRestricted){return s._("Your friends, {user}'s friends and event guests; Except: Restricted",{user:this._tags[0]});}else return s._("Your friends, {user}'s friends and event guests",{user:this._tags[0]});}else if(this._hasRestricted){return s._("Your friends and {user}'s friends; Except: Restricted",{user:this._tags[0]});}else return s._("Your friends and {user}'s friends",{user:this._tags[0]});}else if(u){return this._hasRestricted?"Your friends and event guests; Except: Restricted":"Your friends and event guests";}else return this._hasRestricted?"Your friends; Except: Restricted":"Your friends";},_recalcFriendsMinusTooltip:function(){var u=this._hasEvent,v=this._tags.length;if(u){if(v>1||this._alreadyHasTags()){return this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Acquaintances, Restricted":"Your friends, friends of anyone tagged and event guests; Except: Acquaintances";}else if(v==1){return this._hasRestricted?s._("Your friends, {user}'s friends and event guests; Except: Acquaintances, Restricted",{user:this._tags[0]}):s._("Your friends, {user}'s friends and event guests; Except: Acquaintances",{user:this._tags[0]});}else return this._hasRestricted?"Your friends and event guests; Except: Acquaintances, Restricted":"Your friends and event guests; Except: Acquaintances";}else if(v>0||this._alreadyHasTags()){var w="friends of anyone tagged",x=r._("{people who can see this}, {list of more people who can see this}",[r.param("people who can see this","Your friends"),r.param("list of more people who can see this",w)]),y="Acquaintances";if(this._hasRestricted)y=r._("{Name of Acquaintances friend list}, {restricted}",[r.param("Name of Acquaintances friend list",y),r.param("restricted","Restricted")]);return this._getCombinedSentence(x,y);}else{if(this._hasRestricted)return "Friends; Except: Acquaintances, Restricted";return "Friends except Acquaintances";}},_recalcCustomTooltip:function(){var u=this._getIncludedAudience(),v=this._getTagExpansionText();if(v)u=r._("{list of people who can see this}, {list of additional people who can see this}",[r.param("list of people who can see this",u),r.param("list of additional people who can see this",v)]);return this._getCombinedSentence(u,this._excludedAudience);}});e.exports=t;});
__d("CustomPrivacyOptionController",["Arbiter","AsyncDialog","AsyncRequest","DOM","Event","Form","Parent","PrivacyConst","PrivacySelectorOption","SelectorDeprecated","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('DOM'),k=b('Event'),l=b('Form'),m=b('Parent'),n=b('PrivacyConst'),o=b('PrivacySelectorOption'),p=b('SelectorDeprecated'),q=b('copyProperties');function r(s,t){if(!s)return;(function(){this._selector=m.byClass(s,'audienceSelector');if(!this._selector)return;this.initCustomState(s,t.option_id,t.id);var u={priv_base_val:t.base_audience_value,audience_count:t.audience_count,is_custom:true,included:t.included_audience,excluded:t.excluded_audience,tag_expansion_behavior:t.tag_expansion_behavior};this._optionJSInstance=new o(s,u);k.listen(s,'click',function(event){this.openCustomDialog(event,t.option_id,t.explain_tags,t.autosave,t.limit_to_friends,t.source);}.bind(this));p.listen(this._selector,'select',function(v){if(v.option._id!=this._id)this.clearCustomState();}.bind(this));}).bind(this).defer();}q(r,{_instances:{},update:function(s,t,u,v,w,x,y,z,aa){var ba=r._instances[s];ba._update(t,u)._updateOption(u,w,x,y,z,aa);g.inform('Form/change',{node:ba._container});},getData:function(s){return r._instances[s]._privacyData;},setPrivacyData:function(s,t,u){r._instances[s]._update(t,u);}});q(r.prototype,{_updateOption:function(s,t,u,v,w,x){var y=p.getOption(this._selector,s)||p.getOption(this._selector,n.BaseValue.CUSTOM+''),z=this._optionJSInstance.updateOption(t,u,v,w,x);g.inform('CustomPrivacyOptionController/update',{selector:this._selector,option:y,tooltip:z.tooltip,label:z.label});return this;},_update:function(s,t){var u=t==n.BaseValue.CUSTOM||!p.getOption(this._selector,t),v=this._selector.getAttribute('data-name');this.updateCustomState(s,u,v);return this;},initCustomState:function(s,t,u){r._instances[t]=this;this._container=j.find(s,'.customPrivacyInputs');this._id=u;this._privacyData={};var v=l.serialize(this._container);if(v.audience)this._privacyData=v.audience[u];return s;},openCustomDialog:function(event,s,t,u,v,w){var x=new i('/ajax/privacy/custom_dialog/').setData({option_id:s,id:this._id,privacy_data:this._privacyData,explain_tags:t,autosave:u,limit_to_friends:v,source:w});x.setRelativeTo(event.getTarget());h.send(x);},updateCustomState:function(s,t,u){this.clearCustomState();this._privacyData=q({},s);if(t)if(u){u=u.slice(0,-'[value]'.length);var v={};v[u]=s;l.createHiddenInputs(v,this._container,null,true);}},clearCustomState:function(){this._privacyData={};j.empty(this._container);}});e.exports=r;});
__d("AudienceSelector",["Arbiter","AudienceSelectorTags","CSS","CustomPrivacyOptionController","DOM","DynamicIconSelector","PrivacyConst","SelectorDeprecated"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AudienceSelectorTags'),i=b('CSS'),j=b('CustomPrivacyOptionController'),k=b('DOM'),l=b('DynamicIconSelector'),m=b('PrivacyConst'),n=b('SelectorDeprecated'),o={};n.subscribe('select',function(q,r){if(!i.hasClass(r.selector,'audienceSelector'))return;var s=n.getOptionValue(r.option);r.value=s;g.inform('AudienceSelector/changed',r);if(s==m.BaseValue.CUSTOM&&!i.hasClass(r.option,'noDialog')){n.toggle(r.selector);return false;}if(i.hasClass(r.selector,'dataTooltip')){var t=k.find(r.option,'.itemAnchor').getAttribute('data-tooltip');n.setButtonTooltip(r.selector,t||null);}if(!i.hasClass(r.option,'specialOption'))return;var u=k.find(r.option,'a').getAttribute('data-type');if(i.hasClass(r.option,'moreOption')){i.addClass(r.selector,u);i.addClass(r.selector,'showSecondaryOptions');return false;}else if(i.hasClass(r.option,'returnOption')){i.removeClass(r.selector,'showSecondaryOptions');i.removeClass(r.selector,'friendList');return false;}});var p={keepSynchronized:function(q,r){o[q]||(o[q]={});o[q][r.id]=r;},setHasTags:function(q){h.setHasTags(q);},forceAndKeepSynchronized:function(q,r){p.keepSynchronized(q,r);g.inform('AudienceSelector/update',{option:n.getSelectedOptions(r)[0],selector:r});}};g.subscribe('CustomPrivacyOptionController/update',function(q,r){if(!i.hasClass(r.selector,'audienceSelector'))return;n.setSelected(r.selector,n.getOptionValue(r.option));l.swapIcon(r.selector);var s=i.hasClass(r.selector,'composerAudienceSelector');s&&n.setButtonLabel(r.selector,r.label);n.setButtonTooltip(r.selector,r.tooltip);g.inform('AudienceSelector/update',r);});g.subscribe(['AudienceSelector/changed','AudienceSelector/update'],function(event,q){var r=n.getOptionValue(q.option),s={};if(r==m.BaseValue.CUSTOM){if(event=='AudienceSelector/changed')return;s=j.getData(q.option.id);}for(var t in o){var u=o[t];if(u[q.selector.id]){g.inform('AudienceSelector/syncNonSelectorIcon',{category:t});for(var v in u){var w=u[v];if(!w||q.selector===w)continue;if(n.getValue(w)!==r){n.setSelected(w,r);l.swapIcon(w);}if(r==m.BaseValue.CUSTOM){var x=n.getOption(w,m.BaseValue.CUSTOM+'');if(x){j.setPrivacyData(x.id,s,r);n.setButtonTooltip(w,q.tooltip);}}}}}});e.exports=p;});
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("FriendListPrivacyOptions",["Arbiter","AsyncDialog","AsyncRequest","Dialog","DOMQuery","PageTransitions","Parent","SelectorDeprecated","$","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('Dialog'),k=b('DOMQuery'),l=b('PageTransitions'),m=b('Parent'),n=b('SelectorDeprecated'),o=b('$'),p=b('ge'),q=false,r=false,s=null,t={},u=function(w){if(!Object.keys(t).length)l.registerHandler(function(){t={};q=false;r=false;});var x=w.getAttribute('data-name');t[x]=w;n.listen(w,'select',function(y){var z=y.option,aa=k.find(z,'a.itemAnchor'),ba=aa.getAttribute('data-flid');if(!ba)return;var ca=aa.getAttribute('data-dynamic');if(ca&&q){v.showSmartListNux(z,ba);}else if(!ca&&r)v.showDumbListNux([ba]);});},v={listen:function(w,x,y){var z=p(w);if(!z)return;var aa=m.byClass(z,'audienceSelector');if(aa){u(aa);q=x;r=y;}},showSmartListNux:function(w,x){w=o(w);new i('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:w.id,flid:x}).send();q=false;},setContextualDialog:function(w,x){x=o(x);var y=m.byClass(x,'audienceSelector');if(y){w.setContext(y);w.show();var z=g.subscribe('composer/publish',function(){w.hide();});w.subscribe('hide',function(){z.unsubscribe();});}},showDumbListNux:function(w){h.send(new i('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:w}));r=false;},showBothListsNux:function(w,x){s=o(w);v.showDumbListNux(x);},setDialogX:function(w){if(!s)return;w.subscribe('hide',function(){v.showSmartListNux(s);s=null;});},setDialog:function(){if(!s)return;var w=j.getCurrent();if(w)w.setCloseHandler(function(){v.showSmartListNux(s);s=null;});}};e.exports=v;});
__d("MetaComposerEdDialog",["Animation","Arbiter","ARIA","AsyncRequest","copyProperties","CSS","DOM","Ease","ge","Parent","SelectorDeprecated","Vector"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ARIA'),j=b('AsyncRequest'),k=b('copyProperties'),l=b('CSS'),m=b('DOM'),n=b('Ease'),o=b('ge'),p=b('Parent'),q=b('SelectorDeprecated'),r=b('Vector'),s=null;function t(u){this._dialog=u.dialog;this.config=u;this._init();}t.init=function(u){if(s){s.config.show_audience=u.show_audience;u.dialog.destroy();return;}s=new t(u);};k(t.prototype,{_init:function(){h.subscribe('ComposerXStatusAttachment/ready',function(){if(this.config.show_audience){this._sendEducationRequest({},'/ajax/composer/audience/education',this._handlerCustomDuration.bind(this,6000));this.config.show_audience=false;}}.bind(this));if(this.config.show_sticky)h.subscribe('composer/mutate',function(u,v){this._sendEducationRequest({sticky_num:this.config.n_sticky_shown},'/ajax/composer/audience/sticky_education');}.bind(this));if(this.config.show_event_tags)if(this.config.n_event_tag_shown===0){h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({selector:'div.fbComposerAudienceTourContext',privacy:v.privacy,event_tag_num:this.config.n_event_tag_shown},'/ajax/events/tagging/user_education');}.bind(this));h.subscribe(['composer/publish','composer/reset'],function(){var u=o("event_tagging_tag_expansion_NUX");u&&l.hide(u);}.bind(this));}else h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'AtTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));if(this.config.show_tags)h.subscribe('SelectedPrivacyOption/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'WithTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'/ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));q.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(u,v,w){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new j(v);this._async.setData(u).setHandler(w).send();},_updateDialogContext:function(){var u=m.scry(document.body,'div.composerAudienceWrapper'),v,w;for(var x=0;x<u.length;x++){v=u[x];w=r.getElementPosition(v);if(v&&w.x>0&&w.y>0){this._dialog.setContext(v);return true;}}return false;},_handler:function(u){this._handlerCustomDuration(1500,u);},_handlerCustomDuration:function(u,v){var w=v.payload;if(!w||!this._updateDialogContext())return;var x=this._dialog.getContent().firstChild;m.setContent(x,w);i.announce(m.getText(x));this._dialog.show();var y=p.byClass(x,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=new g(y);}else this._anim=new g(y).from('opacity',0);this._anim.to('opacity',1).ease(n.sineOut).checkpoint().duration(u).checkpoint().to('opacity',0).ease(n.sineOut).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(u,v){if(this._anim){this._dialog.hide();this._anim.stop();this._anim=null;}}});e.exports=t;});
__d("legacy:DynamicIconSelector",["DynamicIconSelector"],function(a,b,c,d){a.DynamicIconSelector=b('DynamicIconSelector');},3);
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20'].join(''),h='.,+*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:^|[^#])('+i+'+)|'+k+')',m='(?:'+i+'{4,})',n='#\\uFF03',o={trigger:new RegExp('['+g+']$'),hashtagTrigger:new RegExp('['+n+']'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=o;});
__d("MentionsInput",["function-extensions","Arbiter","ArbiterMixin","Bootloader","CSS","DataStore","DOM","Event","HTML","Input","InputSelection","Keys","MentionsInputMatchers","Parent","Style","TokenizeUtil","UserAgent","htmlize","mixin","removeFromArray","repeatString"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Bootloader'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Event'),n=b('HTML'),o=b('Input'),p=b('InputSelection'),q=b('Keys'),r=b('MentionsInputMatchers'),s=b('Parent'),t=b('Style'),u=b('TokenizeUtil'),v=b('UserAgent'),w=b('htmlize'),x=b('mixin'),y=b('removeFromArray'),z=b('repeatString'),aa='\uFEFF',ba=new RegExp(aa,'g'),ca=function(ma){return ma+aa;},da='\uFFFD',ea=/@+\[[0-9]+\:([^\]]|\\\])*\]+/g,fa=/[\\\]:]/g;function ga(ma,na){return ma.replace(na,z(' ',na.length));}function ha(ma,na){return ma.substring(0,na)+ma.substring(na+1);}var ia=x(h);for(var ja in ia)if(ia.hasOwnProperty(ja))la[ja]=ia[ja];var ka=ia===null?null:ia.prototype;la.prototype=Object.create(ka);la.prototype.constructor=la;la.__superConstructor__=ia;function la(ma,na,oa,pa,qa,ra){k.set(ma,'MentionsInput',this);this._root=ma;this._typeahead=na;this._input=oa;var sa=null,ta=this.init.bind(this,pa,qa,ra);try{sa=document.activeElement===this._input;}catch(ua){}if(sa){ta.defer();}else var va=m.listen(this._input,'focus',function(){ta.defer();va.remove();});this._hasHashtags=pa.hashtags;this._autoSuggestPages=pa.autosuggest_pages;this._hashtags=[];}la.prototype.init=function(ma,na,oa){if(this._initialized)return;this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=ma.max||6;this._metrics=oa;if(!this._hiddenInput.name){var pa=this._input.name;this._input.name=pa+'_text';this._hiddenInput.name=pa;}this._initEvents();this._initTypeahead();this.reset(na);this.inform('init',null,g.BEHAVIOR_STATE);};la.prototype.reset=function(ma){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;o.setPlaceholder(this._input,this._placeholder);t.set(this._typeahead.getElement(),'height','auto');var na=ma&&ma.value||'',oa=ma&&ma.mentions;if(oa&&oa.length){var pa=[];oa.forEach(function(qa){pa.push(qa.offset+qa.length);delete qa.offset;delete qa.length;this._addToken(qa);},this);pa.reverse().forEach(function(qa){na=na.substring(0,qa)+aa+na.substring(qa);});}o.setValue(this._input,na);this._updateTypeahead();this._updateWidth();this._update();};la.prototype.getValue=function(){return this._getMarkedValue().replace(ba,'');};la.prototype._getMarkedValue=function(){return o.getValue(this._input);};la.prototype.getRawValue=function(){this._update();return o.getValue(this._hiddenInput);};la.prototype.checkValue=function(){var ma=this._typeahead.getCore().getValue();if(r.trigger.exec(ma)||ma==='')this.inform('sessionEnd',{});};la.prototype.getTypeahead=function(){return this._typeahead;};la.prototype._initEvents=function(){var ma=this._update.bind(this);m.listen(this._input,{input:ma,keyup:ma,change:ma,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this),keydown:this._handleKeydown.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);m.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}};la.prototype._initTypeahead=function(){this._typeahead.subscribe('select',function(ra,sa){var ta=sa.selected;this._addToken({uid:ta.uid,text:ta.text,type:ta.type,weakreference:ta.weak_reference});this.updateValue();}.bind(this));var ma=this._input,na=null;function oa(){if(na===null){na=o.getSubmitOnEnter(ma);o.setSubmitOnEnter(ma,false);}}function pa(){if(na!==null){o.setSubmitOnEnter(ma,na);na=null;}}this._typeahead.subscribe('reset',pa);this._typeahead.subscribe('render',oa);this._typeahead.subscribe('highlight',function(ra,sa){sa.index>=0?oa():pa();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));var qa=this._typeahead.getCore();qa.suffix=aa;this._handleFocus();};la.prototype._handleBlur=function(){if(this._filterToken){this._filterToken.remove();this._filterToken=null;}};la.prototype._handleFocus=function(){if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();};la.prototype._handleKeydown=function(event){var ma=event.keyCode;if(ma==q.BACKSPACE||ma==q.DELETE)this._handleBackspaceAndDelete(event,ma);if(ma==q.LEFT||ma==q.RIGHT)setTimeout(this._handleLeftAndRight.bind(this,ma),10);};la.prototype._handleLeftAndRight=function(ma){var na=this._getMarkedValue(),oa=p.get(this._input),pa=oa.start,qa=oa.end,ra=ma==q.LEFT,sa=ma==q.RIGHT;if(pa==qa){var ta=ra?-1:1;if(na.charAt(pa)==aa)p.set(this._input,pa+ta);}else if(ra&&na.charAt(pa)==aa){p.set(this._input,pa-1,qa);}else if(ra&&na.charAt(qa)==aa){p.set(this._input,pa,qa-1);}else if(sa&&na.charAt(qa)==aa){p.set(this._input,pa,qa+1);}else if(sa&&na.charAt(pa)==aa)p.set(this._input,pa+1,qa);};la.prototype._handleBackspaceAndDelete=function(event,ma){var na=p.get(this._input),oa=false;if(na.start!==na.end)if(this._offsetIsInsideMention(na.start+1)&&this._offsetIsInsideMention(na.end)){oa=(ma===q.BACKSPACE);}else return;var pa=ma===q.DELETE?1:-1,qa=pa+(oa?na.end:na.start),ra=this._getMarkedValue(),sa=ra;for(var ta=0;ta<this._orderedUIDs.length;++ta){var ua=this._mentioned[this._orderedUIDs[ta]],va=ua.text,wa=ca(va),xa=sa.indexOf(wa),ya=xa+wa.length;if(qa<xa||qa>=ya){sa=ga(sa,wa);continue;}var za,ab;if(ua.type!='user'){za=0;ab=[va];}else{za=wa.substring(0,qa-xa).split(' ').length-1;ab=va.split(' ');}var bb=ab.splice(za,1)[0],cb=ab.join(' '),db=za===0?xa:ya-bb.length-1;if(cb){ua.text=cb;cb=ca(cb);}else this._removeToken(ua.uid);var eb=ra.substring(0,xa)+cb+ra.substring(ya);o.setValue(this._input,eb);p.set(this._input,db);this._update();event.kill();break;}};la.prototype._offsetIsInsideMention=function(ma){for(var na=0;na<this._offsets.length;na++)if(ma>this._offsets[na][0]&&ma<=this._offsets[na][1])return true;return false;};la.prototype._filterResults=function(ma){if(this._filterData===null){var na=p.get(this._input).start;if(this._offsetIsInsideMention(na)){this._filterData={caretIsInsideMention:true};return false;}var oa=this._typeahead.getCore();this._filterData={value:oa.getValue(),rawValue:oa.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(r.mainMatcher.test(this._filterData.rawValue))return true;if(ma.type!='user'&&!this._shouldIncludeNonUserItem(ma))return false;if(ma.disable_autosuggest)return false;if(r.userMatcher.test(this._filterData.value))return true;return u.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(ma));};la.prototype._shouldIncludeNonUserItem=function(ma){if(this._autoSuggestPages!='false'&&ma.connected_page)return true;if(this._autoSuggestPages=='include_authoritative'&&ma.is_authoritative_person)return true;return false;};la.prototype._addToken=function(ma){var na=ma.uid;if(!this._mentioned.hasOwnProperty(na)){this._mentioned[na]=ma;this._orderedUIDs.push(na);this._numMentioned++;this._updateTypeahead();}};la.prototype._removeToken=function(ma){if(this._mentioned.hasOwnProperty(ma)){delete this._mentioned[ma];y(this._orderedUIDs,ma);this._numMentioned--;this._updateTypeahead();}};la.prototype._update=function(){var ma=this._getMarkedValue();if(ma==this._value)return;this._value=ma;this._updateMentions();this._updateDirection.bind(this).defer();this.updateValue();};la.prototype._updateMentions=function(){this._offsets=[];var ma=this._getMarkedValue(),na=ma;for(var oa=0;oa<this._orderedUIDs.length;++oa){var pa=this._orderedUIDs[oa],qa=ca(this._mentioned[pa].text),ra=na.indexOf(qa);if(ra==-1)this._removeToken(pa);na=ga(na,qa);this._offsets.push([ra,ra+qa.length]);}var sa=ma;while((ra=na.indexOf(aa))>-1){sa=ha(sa,ra);na=ha(na,ra);}if(ma!==sa){var ta=p.get(this._input);o.setValue(this._input,sa);p.set(this._input,ta.start);this._value=sa;}};la.prototype._renderHashtags=function(ma){if(!this._hasHashtags)return w(ma);if(!this._hashtagParser){if(r.hashtagTrigger.exec(ma))this.bootloadHashtagParser();if(!this._hashtagParser)return w(ma);}this._hashtags=this._hashtagParser.parse(ma);var na=[],oa=0;for(var pa=0;pa<this._hashtags.length;pa++){var qa=this._hashtags[pa];na.push(w(ma.substring(oa,qa.rawOffset)),'<b>',qa.marker,qa.tag,'</b>');oa=qa.rawOffset+qa.marker.length+qa.tag.length;}na.push(w(ma.substring(oa)));return na.join('');};la.prototype.updateValue=function(){var ma=this._value=this._getMarkedValue(),na=this._orderedUIDs,oa=ma.replace(ea,da);for(var pa=0;pa<na.length;++pa){var qa='@['+na[pa]+':]',ra=ca(this._mentioned[na[pa]].text);oa=oa.replace(ra,qa);ma=ma.replace(ra,qa);}var sa=this._renderHashtags(ma);for(var pa=0;pa<na.length;++pa){var ta=na[pa],ua=this._mentioned[ta],va=ua.text,wa=ua.weakreference?'<b class="weak">':'<b>';sa=sa.replace('@['+ta+':]',wa+w(ca(va))+'</b>');va=va.replace(fa,function(xa){return '\\'+xa;});oa=oa.replace('@['+ta+':]','@['+ta+':'+va+']');}if(v.ie())sa=sa.replace(/ /g,'&nbsp;<wbr/>');l.setContent(this._highlighterContent,n(sa));this._hiddenInput.value=oa;this._updateHighlighter();this._updateHeight();};la.prototype._updateDirection=function(){var ma=t.get(this._input,'direction');if(ma==this._dir)return;this._dir=ma;t.set(this._highlighter,'direction',ma);if(ma=='rtl'){t.set(this._highlighter,'text-align','right');}else t.set(this._highlighter,'text-align','left');};la.prototype._updateWidth=function(){var ma=t.getFloat.curry(this._input),na=this._input.offsetWidth-ma('paddingLeft')-ma('paddingRight')-ma('borderLeftWidth')-ma('borderRightWidth');if(v.firefox())na-=2;if(v.ie()<=7){na-=t.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(na,0)+'px';};la.prototype._updateHeight=function(){if(this._highlighterAuxContent){var ma=this._highlighter.offsetHeight,na=this._typeahead.getElement();if(ma>na.offsetHeight){t.set(na,'height',ma+'px');g.inform('reflow');}}};la.prototype._updateTypeahead=function(){var ma=this._typeahead.getCore(),na=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)na=r.autoMatcher;ma.matcher=na;ma.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});};la.prototype.setPlaceholder=function(ma){this._placeholder=ma;if(!this.hasAuxContent())o.setPlaceholder(this._input,ma);};la.prototype._updateHighlighter=function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent()||this._hashtags.length);};la.prototype.setAuxContent=function(ma){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,ma);if(ma){o.setPlaceholder(this._input,'');}else o.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}};la.prototype.hasAuxContent=function(){var ma=this.getAuxContentRoot();return ma&&ma.innerHTML.length>0;};la.prototype.getAuxContentRoot=function(){return this._highlighterAuxContent;};la.prototype.addMention=function(ma){var na=this._getMarkedValue();if(na!=='')na+=' ';o.setValue(this._input,na+ca(ma.text)+' ');this._addToken(ma);this._update();};la.prototype.getMentions=function(){return this._mentioned;};la.prototype.bootloadHashtagParser=function(){if(!this._hashtagParser)i.loadModules(['HashtagParser'],function(ma){this._hashtagParser=ma;if(this._initialized){this._value=null;this._update();}}.bind(this));};la.getInstance=function(ma){var na=s.byClass(ma,'uiMentionsInput');return na?k.get(na,'MentionsInput'):null;};e.exports=la;});
__d("MentionsTypeaheadAreaView",["ContextualTypeaheadView","Parent"],function(a,b,c,d,e,f){var g=b('ContextualTypeaheadView'),h=b('Parent');for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(){if(g!==null)g.apply(this,arguments);}k.prototype.getContext=function(){return h.byClass(this.element,'uiMentionsInput');};e.exports=k;});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("TypeaheadAreaCore",["InputSelection","TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('InputSelection'),h=b('TypeaheadCore'),i=b('copyProperties'),j=b('emptyFunction');for(var k in h)if(h.hasOwnProperty(k))m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(n){h.call(this,n);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}m.prototype.select=function(n){l.select.call(this,n);var o=this.element.value,p=this.prefix+n.text+this.suffix;this.expandBounds(o,p);var q=o.substring(0,this.start),r=o.substring(this.end);this.element.value=q+p+r;g.set(this.element,q.length+p.length);};m.prototype.expandBounds=function(n,o){n=n.toLowerCase();o=o.toLowerCase();var p,q,r,s,t=/\s/;q=n.substring(this.start,this.end);r=o.indexOf(q);p=this.start;while(p>=0&&r>=0){s=n.charAt(p-1);if(!s||t.test(s))this.start=p;q=s+q;r=o.indexOf(q);p--;}q=n.substring(this.start,this.end);r=o.indexOf(q);p=this.end;while(p<=n.length&&r>=0){s=n.charAt(p);if(!s||t.test(s))this.end=p;q=q+s;r=o.indexOf(q);p++;}};m.prototype.getRawValue=function(){var n=g.get(this.element).start||0;return l.getValue.call(this).substring(0,n);};m.prototype.getValue=function(){var n=this.matcher&&this.matcher.exec(this.getRawValue());if(!n)return '';var o=n[0],p=n.index+o.length;o=o.replace(/^\s/,'');var q=o.length;o=o.replace(/\s$/,'');var r=q-o.length;this.start=p-q;this.end=p+r;return n[2]||n[1]||n[0];};i(m.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:j});e.exports=m;});
__d("TypeaheadMetrics",["AsyncRequest","Event","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Event'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this.extraData={};i(this,l);}k.prototype.init=function(l){this.init=j;this.core=l.getCore();this.view=l.getView();this.data=l.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();};k.prototype._reset=function(){this.stats={};this.avgStats={};this.sessionActive=false;this.results=null;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});};k.prototype.recordSelect=function(l){var m=l.selected;if(m.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',m.uid);this.recordStat('selected_type',m.type);this.recordStat('selected_position',l.index);this.recordStat('selected_with_mouse',l.clicked?1:0);this.recordStat('selected_query',l.query);this._sessionEnd();};k.prototype.bindSessionStart=function(l,event,m){if(m)for(var n=0;n<this._sessionStartEvents.length;++n){var o=this._sessionStartEvents[n];o.obj.unsubscribe(o.token);}this._sessionStartEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionStart();}.bind(this))});};k.prototype.bindSessionEnd=function(l,event,m){if(m)for(var n=0;n<this._sessionEndEvents.length;++n){var o=this._sessionEndEvents[n];o.obj.unsubscribe(o.token);}this._sessionEndEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionEnd();}.bind(this))});};k.prototype.initEvents=function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(l,m){this.recordSelect(m);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(l,m){this.results=m;}.bind(this));this.data.subscribe('beforeQuery',function(l,m){if(!m.value)return;this.query=m.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(l,m){if(m.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else m.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(l,m){if(m.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var n={};m.response.payload.entries.forEach(function(o){if(!n[o.type]){n[o.type]=1;}else n[o.type]++;});this.recordStat('bootstrap_response_types',n);this.bootstrapped=true;}else{if('filtered_count' in m.response.payload)this.recordStat('filtered_count',m.response.payload.filtered_count);this.recordAvgStat('avg_query_latency',Date.now()-m.fetch_context.queryBegin);}}.bind(this));this.data.subscribe('dirty',function(l,m){this.bootstrapped=false;}.bind(this));};k.prototype._sessionStart=function(){if(this.sessionActive)return;this.sessionActive=true;};k.prototype._sessionEnd=function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();};k.prototype.recordStat=function(l,m){this.stats[l]=m;};k.prototype.recordCountStat=function(l){var m=this.stats[l];this.stats[l]=m?m+1:1;};k.prototype.recordAvgStat=function(l,m){if(this.avgStats[l]){this.avgStats[l][0]+=m;++this.avgStats[l][1];}else this.avgStats[l]=[m,1];};k.prototype.hasStats=function(){return !!Object.keys(this.stats).length;};k.prototype.submit=function(){if(this.hasStats()){i(this.stats,this.extraData);if(this.results){var l=(this.results).map(function(o,p){return o.uid;});this.recordStat('candidate_results',JSON.stringify(l));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var m in this.avgStats){var n=this.avgStats[m];this.stats[m]=n[0]/n[1];}new g().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}};k.register=function(l,m,n){if(document.activeElement===l){m.init(n);}else var o=h.listen(l,'focus',function(){m.init(n);o.remove();});};i(k.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php'});e.exports=k;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}h.prototype.enable=function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[],n=[];for(var o=0;o<k.results.length;++o){var p=k.results[o];if(p.type=='header'){n=n.concat(m,l);n.push(p);m=[];l=[];}else if(p.type=='user'&&p.bootstrapped){m.push(p);}else l.push(p);}k.results=n.concat(m,l);});};h.prototype.disable=function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;};g(h.prototype,{_subscription:null});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);
/*!CK:2983036393!*//*1380119687,180816457*/

if (self.CavalryLogger) { CavalryLogger.start_js(["t+pvW"]); }

__d("MercuryAPIArgsSource",[],function(a,b,c,d,e,f){e.exports={JEWEL:"jewel",CHAT:"chat",MERCURY:"mercury",WEBMESSENGER:"web_messenger"};});
__d("MercuryActionStatus",[],function(a,b,c,d,e,f){e.exports={UNCONFIRMED:3,UNSENT:0,RESENDING:7,RESENT:6,UNABLE_TO_CONFIRM:5,FAILED_UNKNOWN_REASON:4,SUCCESS:1,ERROR:10};});
__d("MercuryActionTypeConstants",[],function(a,b,c,d,e,f){e.exports={LOG_MESSAGE:"ma-type:log-message",CLEAR_CHAT:"ma-type:clear_chat",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",CHANGE_FOLDER:"ma-type:change-folder",SEND_MESSAGE:"ma-type:send-message",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",DELETE_THREAD:"ma-type:delete-thread",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings"};});
__d("MercuryAttachmentContentType",[],function(a,b,c,d,e,f){e.exports={UNKNOWN:"attach:unknown",PHOTO:"attach:image",VIDEO:"attach:video",MSWORD:"attach:ms:word",VOICE:"attach:voice",MSPPT:"attach:ms:ppt",TEXT:"attach:text",MUSIC:"attach:music",MSXLS:"attach:ms:xls"};});
__d("MercuryAttachmentType",[],function(a,b,c,d,e,f){e.exports={STICKER:"sticker",PHOTO:"photo",FILE:"file",SHARE:"share",ERROR:"error"};});
__d("MercuryErrorType",[],function(a,b,c,d,e,f){e.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};});
__d("MercuryGenericConstants",[],function(a,b,c,d,e,f){e.exports={PENDING_THREAD_ID:"pending:pending"};});
__d("MercuryGlobalActionType",[],function(a,b,c,d,e,f){e.exports={MARK_ALL_READ:"mga-type:mark-all-read"};});
__d("MercuryLogMessageType",[],function(a,b,c,d,e,f){e.exports={SERVER_ERROR:"log:error-msg",UNSUBSCRIBE:"log:unsubscribe",JOINABLE_JOINED:"log:joinable-joined",JOINABLE_CREATED:"log:joinable-created",LIVE_LISTEN:"log:live-listen",PHONE_CALL:"log:phone-call",THREAD_IMAGE:"log:thread-image",THREAD_NAME:"log:thread-name",VIDEO_CALL:"log:video-call",SUBSCRIBE:"log:subscribe"};});
__d("MercuryParticipantTypes",[],function(a,b,c,d,e,f){e.exports={FRIEND:"friend",USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page"};});
__d("MercuryPayloadSource",[],function(a,b,c,d,e,f){e.exports={SERVER_INITIAL_DATA:"server_initial_data",CLIENT_DELETE_THREAD:"client_delete_thread",SERVER_SAVE_DRAFT:"server_save_draft",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_SEARCH:"server_search",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_MARK_SEEN:"server_mark_seen",SERVER_THREAD_SYNC:"server_thread_sync",CLIENT_DELETE_MESSAGES:"client_delete_messages",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_CLEAR_CHAT:"client_clear_chat",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_SEND_MESSAGE:"server_send_message",CLIENT_SAVE_DRAFT:"client_save_draft",UNKNOWN:"unknown",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_CONFIRM_MESSAGES:"server_confirm_messages",SERVER_TAB_PRESENCE:"server_tab_presence",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_HANDLE_ERROR:"client_handle_error"};});
__d("MercurySourceType",[],function(a,b,c,d,e,f){e.exports={TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",WEBRTC_MOBILE:"source:webrtc:mobile",GIGABOXX_API:"source:gigaboxx:api",TITAN_BLAST:"source:titan:blast",TITAN_M_JAPAN:"source:titan:m_japan",BUFFY_SMS:"source:buffy:sms",SEND_PLUGIN:"source:sendplugin",CHAT_MEEBO:"source:chat:meebo",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TEST:"source:test",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_EMAIL_REPLY:"source:titan:emailreply",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_ORCA:"source:titan:orca",TITAN_M_TOUCH:"source:titan:m_touch",CHAT:"source:chat",CHAT_IPHONE:"source:chat:iphone",TITAN_WEB:"source:titan:web",UNKNOWN:"source:unknown",TITAN_M_MINI:"source:titan:m_mini",GIGABOXX_MOBILE:"source:gigaboxx:mobile",HELPCENTER:"source:helpcenter",PAID_PROMOTION:"source:paid_promotion",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",TITAN_M_TALK:"source:titan:m_talk",GIGABOXX_BLAST:"source:gigaboxx:blast",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",CHAT_WEB:"source:chat:web",TITAN_M_TABLET:"source:titan:m_tablet",WEB:"source:web",SOCIALFOX:"source:socialfox",EMAIL:"source:email",TITAN_API:"source:titan:api",GIGABOXX_WEB:"source:gigaboxx:web",DESKTOP:"source:desktop",LEIA:"source:leia",CHAT_JABBER:"source:chat:jabber",CHAT_TEST:"source:chat:test",SHARE_DIALOG:"source:share:dialog",GIGABOXX_WAP:"source:gigaboxx:wap",MOBILE:"source:mobile",TITAN_M_APP:"source:titan:m_app",TITAN_WAP:"source:titan:wap",SMS:"source:sms",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_ZERO:"source:titan:m_zero",NEW_SHARE_DIALOG:"source:share:dialog:new",CHAT_ORCA:"source:chat:orca"};});
__d("MercuryThreadMode",[],function(a,b,c,d,e,f){e.exports={EMAIL_ORIGINATED:1,OBJECT_ORIGINATED:3,TITAN_ORIGINATED:2};});
__d("MessagingTag",[],function(a,b,c,d,e,f){e.exports={MTA_SYSTEM_MESSAGE:"MTA:system_message",SENT:"sent",INBOX:"inbox",SMS_TAG_ROOT:"SMSShortcode:",UPDATES:"broadcasts_inbox",OTHER:"other",GROUPS:"groups",FILTERED_CONTENT:"filtered_content",ACTION_ARCHIVED:"action:archived",UNREAD:"unread",BCC:"header:bcc",SMS_MUTE:"sms_mute",ARCHIVED:"archived",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",EVENT:"event",VOICEMAIL:"voicemail",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SPAM:"spam",EMAIL_MESSAGE:"source:email",EMAIL:"email",APP_ID_ROOT:"app_id:"};});
__d("getActiveElement",[],function(a,b,c,d,e,f){function g(){try{return document.activeElement;}catch(h){return null;}}e.exports=g;});
__d("ReportState",["ErrorUtils","invariant"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h=b('invariant'),i={};function j(l,m){h(!i[l]);i[l]=m;}function k(){var l={};Object.keys(i).forEach(function(m){try{l[m]=i[m]();}catch(n){g.reportError('ReportState: callback threw an error.');}});return l;}e.exports={registerCallback:j,getState:k};});
__d("PresenceUtil",["Cookie","Session","randomInt"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Session'),i=b('randomInt'),j=i(0,4294967295)+1;function k(){return j;}function l(){return h.userID===g.get('c_user');}e.exports={getSessionID:k,hasUserCookie:l};});
__d("TypeaheadFacepile",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(){}h.render=function(i){var j=[g.create('span',{className:'splitpic leftpic'},[g.create('img',{alt:'',src:i[0]})]),g.create('span',{className:'splitpic'+(i[2]?' toppic':'')},[g.create('img',{alt:'',src:i[1]})])];if(i[2])j.push(g.create('span',{className:'splitpic bottompic'},[g.create('img',{alt:'',src:i[2]})]));return g.create('span',{className:'splitpics clearfix'},j);};e.exports=h;});
__d("MercurySingletonMixin",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(g.user);},getForFBID:function(i){var j=this._getInstances();if(!j[i])j[i]=new this(i);return j[i];}};e.exports=h;});
__d("MercuryMessageClientState",[],function(a,b,c,d,e,f){var g={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};e.exports=g;});
__d("MercuryMessageIDs",["KeyedCallbackManager"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=new g(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('mail.projektitan.com')!==-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};e.exports=i;});
__d("ImageSourceType",[],function(a,b,c,d,e,f){var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;});
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){var g={COVER:'s',CONTAIN:'p'};e.exports=g;});
__d("ImageSourceRequest",["Env","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains","extendArray"],function(a,b,c,d,e,f){var g=b('Env'),h=b('ImageSourceType'),i=b('KeyedCallbackManager'),j=b('PhotoResizeModeConst'),k=b('MercuryServerDispatcher'),l=b('arrayContains'),m=b('extendArray');function n(){this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){this._request.fbid=r;return this;};n.prototype.setType=function(r){if(!l([h.PROFILE_PICTURE,h.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){if(!l([j.COVER,j.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){this._callback=r;return this;};n.prototype.send=function(){if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new i();o=r;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.user,mode:k.BATCH_DEFERRED_MULTI,batch_function:function(s,t){m(s.requests,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}e.exports=n;});
__d("MercuryIDs",[],function(a,b,c,d,e,f){function g(i){return typeof i==='string'&&i.indexOf(':')!==-1;}var h={isValid:function(i){if(!i)return false;return g(i);},isValidThreadID:function(i){if(!h.isValid(i))return false;var j=h.tokenize(i);switch(j.type){case 'user':case 'group':case 'thread':case 'root':case 'pending':return true;default:return false;}},tokenize:function(i){if(!this.isValid(i))throw 'bad_id_format';var j=i.indexOf(':');return {type:i.substr(0,j),value:i.substr(j+1)};},getUserIDFromParticipantID:function(i){if(!h.isValid(i))return null;var j=h.tokenize(i);if(j.type!='fbid')return null;return j.value;},isMultichat:function(i){return this.tokenize(i).type!=='user';}};e.exports=h;});
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f){var g=b('MercuryIDs');e.exports={isParticipantID:function(h){if(!g.isValid(h))throw 'bad_participant_id';},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw 'bad_user_id';},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw 'bad_email_id';},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw 'bad_thread_id';}};});
__d("TimestampConverter",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('timestamp_converter');function i(k){return (typeof(k)=='string')&&k.length>6;}var j={convertActionIDToTimestamp:function(k){if(i(k)){var l=k.slice(0,-6);return parseInt(l,10);}},maxValidActionID:function(k,l){if(!i(k))return l;if(!i(l))return k;return this.isGreaterThan(k,l)?k:l;},isGreaterThan:function(k,l){if(!i(k)||!i(l))return false;return this.convertActionIDToTimestamp(k)>this.convertActionIDToTimestamp(l);}};e.exports=j;});
__d("XMercurySendLogControllerURIBuilder",["XControllerURIBuilder","copyProperties"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder'),h=b('copyProperties'),i={path:"\/messaging\/send_logger\/",paramDefinitions:{is_canonical:{type:"Bool"},message_id:{type:"String",required:true},event:{type:"Enum",required:true}}};function j(){g.call(this,i.path,i.paramDefinitions);return this;}h(j.prototype,g.prototype);e.exports=j;});
__d("MercurySendLogger",["AsyncSignal","XMercurySendLogControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h=b('XMercurySendLogControllerURIBuilder'),i=false,j={CLIENT_SEND_ATTEMPTED:'client_send_attempted',CLIENT_RESEND_ATTEMPTED:'client_resend_attempted',CLIENT_SEND_SUCCEEDED:'client_send_succeeded',CLIENT_SEND_FAILED:'client_send_failed',CLIENT_CHANNEL_ECHO:'client_channel_echo',enable:function(){i=true;},log:function(event,k,l){if(!i)return;new g((new h()).setEnum('event',event).setString('message_id',k).setBool('is_canonical',!!l.canonical).getURI().toString()).send();}};e.exports=j;});
__d("MessagingReliabilityLogger",["function-extensions","PresenceUtil","MercuryServerDispatcher","MessagingReliabilityLoggerInitialData","isEmpty","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('function-extensions');var g=b('PresenceUtil'),h=b('MercuryServerDispatcher'),i=b('MessagingReliabilityLoggerInitialData'),j=b('isEmpty'),k=b('setTimeoutAcrossTransitions'),l='/ajax/mercury/client_reliability.php',m=60000;function n(t,u){var v={app:i.app,categories:JSON.stringify(t)};if(!j(u))v.extra=JSON.stringify(u);return v;}function o(t,u,v,w){if(t[u]===undefined)t[u]={};if(t[u][v]===undefined)t[u][v]=0;t[u][v]+=w;}function p(t,u,v,w){if(t[u]===undefined)t[u]={};if(t[u][v]===undefined)t[u][v]=[];for(var x=0;x<w.length;++x)t[u][v].push(w[x]);}function q(t,u){if((t&&!t.categories)||(u&&!u.categories))return;var v=t?JSON.parse(t.categories):{},w=t&&t.extra?JSON.parse(t.extra):{},x=JSON.parse(u.categories),y=u.extra?JSON.parse(u.extra):{};for(var z in x){var aa=x[z],ba=y[z];for(var ca in aa){o(v,z,ca,aa[ca]);if(ba!==undefined){var da=ba[ca];if(da!==undefined)p(w,z,ca,da);}}}return n(v,w);}var r={};r[l]={mode:h.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:q};h.registerEndpoints(r);var s={addEntry:function(t,u,v){if(!i.enabled)return;var w={};o(w,t,u,1);var x={};if(v!==undefined)p(x,t,u,[v]);h.trySend(l,n(w,x));}};(function t(){s.addEntry('page_event','active',g.getSessionID());k(t,m);})();e.exports=s;});
__d("MercuryThreadInformer",["ArbiterMixin","copyProperties","MercuryAssert","MercurySingletonMixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('copyProperties'),i=b('MercuryAssert'),j=b('MercurySingletonMixin');function k(m){if(!m._locked){var n=m._threadDeletions,o=m._threadChanges,p=m._threadReadChanges,q=m._threadlistChanged,r=m._unseenStateChanged,s=m._unreadStateChanged,t=m._receivedMessages,u=m._reorderedMessages,v=m._updatedMessages;m._threadDeletions={};m._threadChanges={};m._threadReadChanges={};m._threadlistChanged=false;m._unseenStateChanged=false;m._unreadStateChanged=false;m._receivedMessages={};m._reorderedMessages={};m._updatedMessages={};var w=Object.keys(o);if(w.length||q)m.inform('threadlist-updated',w);if(w.length)m.inform('threads-updated',o);for(var x in p){m.inform('thread-read-changed',p);break;}for(var x in n){m.inform('threads-deleted',n);break;}if(r)m.inform('unseen-updated',null);if(s)m.inform('unread-updated',null);for(x in t){m.inform('messages-received',t);break;}for(x in u){m.inform('messages-reordered',u);break;}for(x in v){m.inform('messages-updated',v);break;}}}function l(m){this._fbid=m;this._threadDeletions={};this._threadChanges={};this._threadReadChanges={};this._threadlistChanged=false;this._unseenStateChanged=false;this._unreadStateChanged=false;this._receivedMessages={};this._reorderedMessages={};this._updatedMessages={};this._locked=0;}h(l.prototype,g,{updatedThread:function(m){this._threadChanges[m]=true;k(this);},deletedThread:function(m){this._threadDeletions[m]=true;k(this);},updatedThreadlist:function(){this._threadlistChanged=true;k(this);},updatedUnseenState:function(){this._unseenStateChanged=true;k(this);},updatedUnreadState:function(){this._unreadStateChanged=true;k(this);},changedThreadReadState:function(m,n,o){if(!this._threadReadChanges[m]||this._threadReadChanges[m].timestamp<o)this._threadReadChanges[m]={mark_as_read:n,timestamp:o};k(this);},receivedMessage:function(m){i.isThreadID(m.thread_id);var n=m.thread_id;if(!this._receivedMessages[n])this._receivedMessages[n]=[];this._receivedMessages[n].push(m);this.updatedThread(n);},reorderedMessages:function(m,n){this._reorderedMessages[m]={source:n};k(this);},updatedMessage:function(m,n,o){if(!this._updatedMessages[m])this._updatedMessages[m]={};this._updatedMessages[m][n]={source:o};this.updatedThread(m);},synchronizeInforms:function(m){this._locked++;try{m();}catch(n){throw n;}finally{this._locked--;k(this);}},listen:function(m,n){return this.subscribe('threads-updated',function(o,p){if(p[m])n(m);});}});h(l,j);e.exports=l;});
__d("MercuryServerRequests",["ArbiterMixin","AsyncResponse","TimestampConverter","Env","LogHistory","KeyedCallbackManager","MercuryActionTypeConstants","MercuryActionStatus","MercuryAPIArgsSource","MercuryAssert","MercuryErrorType","MercuryGenericConstants","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySendLogger","MercuryServerRequestsConfig","MercurySourceType","MercuryThreadlistConstants","MercuryMessageIDs","MessagingConfig","MessagingReliabilityLogger","MessagingTag","MercurySingletonMixin","MercuryServerDispatcher","MercuryThreadInformer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncResponse'),i=b('TimestampConverter'),j=b('Env'),k=b('LogHistory'),l=b('KeyedCallbackManager'),m=b('MercuryActionTypeConstants'),n=b('MercuryActionStatus'),o=b('MercuryAPIArgsSource'),p=b('MercuryAssert'),q=b('MercuryErrorType'),r=b('MercuryGenericConstants'),s=b('MercuryGlobalActionType'),t=b('MercuryIDs'),u=b('MercuryLogMessageType'),v=b('MercuryMessageClientState'),w=b('MercuryPayloadSource'),x=b('MercurySendLogger'),y=b('MercuryServerRequestsConfig'),z=b('MercurySourceType'),aa=b('MercuryThreadlistConstants'),ba=b('MercuryMessageIDs'),ca=b('MessagingConfig'),da=b('MessagingReliabilityLogger'),ea=b('MessagingTag'),fa=b('MercurySingletonMixin'),ga=b('MercuryServerDispatcher'),ha=b('MercuryThreadInformer'),ia=b('copyProperties'),ja=b('createObjectFrom'),ka=k.getInstance('mercury_server'),la=o.MERCURY;function ma(ub,vb){if(vb)ub._lastActionId=i.maxValidActionID(ub._lastActionId,vb);}function na(ub,vb){var wb=vb.thread_id,xb=ub._serverToClientIDs.getResource(wb);if(!xb){if(vb.canonical_fbid){xb='user:'+vb.canonical_fbid;}else if(vb.root_message_threading_id)xb='root:'+vb.root_message_threading_id;xb=xb||'thread:'+wb;oa(ub,wb,xb);}vb.thread_id=xb;}function oa(ub,vb,wb){ub._serverToClientIDs.setResource(vb,wb);ub._clientToServerIDs.setResource(wb,vb);ub._newlyAddedClientIDs[vb]=wb;}function pa(ub,vb,wb){var xb=ub._clientToServerIDs.executeOrEnqueue(vb,wb),yb=ub._clientToServerIDs.getUnavailableResources(xb),zb=ub.tokenizeThreadID(vb);if(yb.length&&zb.type!='root')ub.fetchThreadData(yb);}function qa(ub,vb){return ub._clientToServerIDs.getResource(vb);}function ra(ub,vb){return !!ub._serverToClientIDs.getResource(vb);}function sa(ub,vb){var wb=ub._serverToClientIDs.getResource(vb);if(typeof wb=='undefined')ka.warn('no_client_thread_id',{server_id:vb});return wb;}function ta(ub,vb,wb){ub._serverToClientIDs.executeOrEnqueue(vb,wb);ub.ensureThreadIsFetched(vb);}function ua(ub,vb,wb){if(vb.action_type!=m.SEND_MESSAGE)return;var xb=vb.client_thread_id;if(!xb)xb=sa(ub,vb.thread_id);var yb=null;if(xb)yb=t.tokenize(xb).type;da.addEntry('send_'+yb,wb,vb.thread_id+','+vb.message_id);x.log(wb==='success'?x.CLIENT_SEND_SUCCEEDED:x.CLIENT_SEND_FAILED,vb.client_message_id,{canonical:yb&&!t.isMultichat(xb)});}function va(ub){return ub.getError()?'_'+ub.getError():'';}function wa(ub,vb){var wb=null;switch(vb.status){case n.SUCCESS:wb='success';break;case n.FAILED_UNKNOWN_REASON:wb='confirmed_error';break;case n.UNABLE_TO_CONFIRM:wb='confirm_error';break;default:return;}ua(ub,vb,wb);}function xa(ub,vb){(vb.message_counts||[]).forEach(function(ec){ma(ub,ec.last_action_id);});(vb.threads||[]).forEach(function(ec){na(ub,ec);delete ub._fetchingThreads[ec.thread_id];var fc=qa(ub,ec.thread_id);delete ub._fetchingThreads[fc];ma(ub,ec.last_action_id);});(vb.ordered_threadlists||[]).forEach(function(ec){ec.thread_ids=ec.thread_ids.map(sa.curry(ub));});vb.actions=vb.actions||[];vb.actions.forEach(function(ec){wa(ub,ec);if(ec.status&&ec.status!=n.SUCCESS&&!ec.thread_id){ec.thread_id=ec.client_thread_id;return;}if(ec.action_type==m.SEND_MESSAGE&&ec.client_thread_id&&ec.client_thread_id!=r.PENDING_THREAD_ID)oa(ub,ec.thread_id,ec.client_thread_id);ec.server_thread_id=ec.thread_id;ec.thread_id=ra(ub,ec.thread_id)?sa(ub,ec.thread_id):null;ma(ub,ec.action_id);});if(vb.end_of_history){var wb=[];for(var xb=0;xb<vb.end_of_history.length;xb++){var yb=vb.end_of_history[xb];if(yb.type=='user'){wb.push('user:'+yb.id);}else if(yb.type=='thread'&&ra(ub,yb.id))wb.push(sa(ub,yb.id));}vb.end_of_history=wb;}if(vb.roger){var zb={};for(var ac in vb.roger){var bc=ub._serverToClientIDs.getResource(ac);if(bc){var cc=vb.roger[ac];zb[bc]={};for(var dc in cc)zb[bc]['fbid:'+dc]=cc[dc];}}vb.roger=zb;}}function ya(ub){if(ub._pendingUpdates&&ub._pendingUpdates.length){var vb=ub._pendingUpdates[0];ub._pendingUpdates=ub._pendingUpdates.slice(1);ub.handleUpdate(vb);}}function za(ub,vb){var wb=ia({},ub),xb;if(vb.threads){if(!wb.threads)wb.threads={};for(xb in vb.threads)wb.threads[xb]=Object.keys(ja((wb.threads[xb]||[]).concat(vb.threads[xb])));}if(vb.messages){if(!wb.messages)wb.messages={};for(xb in vb.messages){if(!wb.messages[xb])wb.messages[xb]={};for(var yb in vb.messages[xb])if(wb.messages[xb][yb]){wb.messages[xb][yb]=cb(wb.messages[xb][yb],vb.messages[xb][yb]);}else wb.messages[xb][yb]=vb.messages[xb][yb];}}wb.client=ub.client||vb.client;return wb;}function ab(ub,vb){var wb=ia(ja(ub.folders,true),ja(vb.folders,true)),xb=ub.client||vb.client;return {folders:Object.keys(wb),client:xb};}function bb(ub,vb){for(var wb in vb)if(ub[wb]&&typeof ub[wb]==='object'){ub[wb]=cb(ub[wb],vb[wb]);}else if(vb[wb]&&typeof vb[wb]==='object'){var xb={};ia(xb,vb[wb]);ub[wb]=xb;}return ub;}function cb(ub,vb){var wb=ub.offset<vb.offset?ub.offset:vb.offset,xb=ub.offset+ub.limit,yb=vb.offset+vb.limit,zb=(xb>yb)?xb:yb,ac=zb-wb;return {offset:wb,limit:ac};}function db(ub,vb){var wb=ub.client||vb.client,xb={ids:{},client:wb};ia(xb.ids,ub.ids);ia(xb.ids,vb.ids);return xb;}function eb(ub,vb){var wb={},xb,yb=ub.client||vb.client;delete ub.client;delete vb.client;for(xb in ub)ia(wb,ja(ub[xb],xb));for(xb in vb)ia(wb,ja(vb[xb],xb));var zb={client:yb};for(var ac in wb){xb=wb[ac];if(!zb[xb])zb[xb]=[];zb[xb].push(ac);}return zb;}function fb(ub,vb){var wb=ub.client||vb.client,xb=ja(ub.ids,true),yb=ja(vb.ids,true),zb=ia(xb,yb);return {ids:Object.keys(zb),client:wb};}function gb(ub){this._fbid=ub;this._lastActionId=0;this._serverToClientIDs=new l();this._clientToServerIDs=new l();this._pendingUpdates=[];this._fetchingThreads={};this._newlyAddedClientIDs={};sb(this);}ia(gb.prototype,g,{tokenizeThreadID:function(ub){p.isThreadID(ub);return t.tokenize(ub);},getServerThreadID:function(ub,vb){p.isThreadID(ub);pa(this,ub,vb);},getClientThreadID:function(ub,vb){ta(this,ub,vb);},getClientThreadIDNow:function(ub){return sa(this,ub);},getServerThreadIDNow:function(ub){return qa(this,ub);},convertThreadIDIfAvailable:function(ub){var vb=this._serverToClientIDs.getResource(ub);if(vb===undefined){return ub;}else return vb;},canLinkExternally:function(ub){p.isThreadID(ub);var vb=this.tokenizeThreadID(ub);return (vb.type=='user')||!!qa(this,ub);},fetchThreadlistInfo:function(ub,vb,wb,xb,yb){wb=wb||ea.INBOX;yb=yb||la;var zb=xb?ga.IMMEDIATE:null,ac={client:yb};ac[wb]={offset:ub,limit:vb,filter:xb};tb(this,'/ajax/mercury/threadlist_info.php',ac,zb);},fetchUnseenThreadIDs:function(ub,vb){vb=vb||la;this.fetchThreadlistInfo(aa.RECENT_THREAD_OFFSET,aa.JEWEL_THREAD_COUNT,ub,null,vb);},fetchUnreadThreadIDs:function(ub,vb){vb=vb||la;tb(this,'/ajax/mercury/unread_threads.php',{folders:[ub],client:vb});},fetchMissedMessages:function(ub,vb){vb=vb||la;tb(this,'/ajax/mercury/thread_sync.php',{last_action_id:this._lastActionId,folders:ub,client:vb});},fetchThreadData:function(ub,vb){vb=vb||la;p.allThreadID(ub);var wb={threads:{},client:vb},xb=[],yb=[];ub.forEach(function(ac){if(this._fetchingThreads[ac])return;this._fetchingThreads[ac]=true;var bc=qa(this,ac);if(bc){yb.push(bc);wb.threads.thread_ids=yb;}else{var cc=this.tokenizeThreadID(ac);if(cc.type=='user'){xb.push(cc.value);wb.threads.user_ids=xb;}else if(cc.type=='thread'){yb.push(cc.value);wb.threads.thread_ids=yb;}else if(cc.type!='root'&&cc.type!='pending')throw new Error('Unknown thread type',cc);}}.bind(this));this.inform("fetch-thread-data",wb);for(var zb in wb.threads){tb(this,'/ajax/mercury/thread_info.php',wb);break;}},ensureThreadIsFetched:function(ub,vb){vb=vb||la;if(!this._serverToClientIDs.getResource(ub)&&!this._fetchingThreads[ub]){this._fetchingThreads[ub]=true;tb(this,'/ajax/mercury/thread_info.php',{threads:{thread_ids:[ub]},client:vb});}},fetchThreadMessages:function(ub,vb,wb,xb,yb){p.isThreadID(ub);yb=yb||la;var zb,ac,bc=this.tokenizeThreadID(ub),cc=qa(this,ub),dc=false;if(cc&&bc.type!='group'){ac='thread_ids';zb=cc;}else{zb=bc.value;switch(bc.type){case 'user':ac='user_ids';dc=true;break;case 'group':ac='group_ids';break;case 'thread':ac='thread_ids';break;}}var ec={messages:{},threads:{},client:yb};if(ac){ec.messages[ac]={};ec.messages[ac][zb]={offset:vb,limit:wb};if(dc)ec.threads[ac]=[zb];tb(this,'/ajax/mercury/thread_info.php',ec,xb);}else pa(this,ub,function(fc){ec.messages.thread_ids={};ec.messages.thread_ids[fc]={offset:vb,limit:wb};tb(this,'/ajax/mercury/thread_info.php',ec,xb);}.bind(this));},handleThreadInfoError:function(ub){var vb=ub.getRequest().getData(),wb=[];if(vb.messages){for(var xb in vb.messages.thread_ids)wb.push(hb(sa(this,xb)));for(var yb in vb.messages.user_ids)wb.push(hb('user:'+yb));for(var zb in vb.messages.group_ids)wb.push(hb('group:'+zb));}if(wb.length)this.handleUpdate({actions:wb,from_client:true,payload_source:w.CLIENT_CHANNEL_MESSAGE});if(vb.threads&&(vb.threads.user_ids||vb.threads.group_ids||vb.threads.thread_ids)){var ac=5,bc=true;if(!vb.retry_count){vb.retry_count=0;if(vb.messages)delete vb.messages;}else if(vb.retry_count>=ac){bc=false;(vb.threads.thread_ids||[]).forEach(function(dc){if(dc in this._fetchingThreads)delete this._fetchingThreads[dc];}.bind(this));}if(bc){var cc=vb.retry_count*1000;(function(){ka.log('retry_thread',vb);tb(this,'/ajax/mercury/thread_info.php',vb);}.bind(this)).defer(cc,false);vb.retry_count++;}}},markFolderAsRead:function(ub){tb(this,'/ajax/mercury/mark_folder_as_read.php',{folder:ub});var vb=[{action_type:s.MARK_ALL_READ,action_id:null,folder:ub}];this.handleUpdate({global_actions:vb,from_client:true,payload_source:w.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(ub,vb,wb){p.isThreadID(ub);pa(this,ub,function(yb){var zb={ids:{}};zb.ids[yb]=vb;tb(this,'/ajax/mercury/change_read_status.php',zb);}.bind(this));var xb=[{action_type:m.CHANGE_READ_STATUS,action_id:null,thread_id:ub,mark_as_read:vb,folder:wb}];this.handleUpdate({actions:xb,from_client:true,payload_source:w.CLIENT_CHANGE_READ_STATUS});},changeThreadArchivedStatus:function(ub,vb){p.isThreadID(ub);pa(this,ub,function(yb){var zb={ids:{}};zb.ids[yb]=vb;tb(this,'/ajax/mercury/change_archived_status.php',zb);}.bind(this));var wb={action_type:m.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ub,archived:vb},xb={actions:[wb],from_client:true,payload_source:w.CLIENT_CHANGE_ARCHIVED_STATUS};this.handleUpdate(xb);},changeThreadFolder:function(ub,vb){p.isThreadID(ub);pa(this,ub,function(yb){var zb={};zb[vb]=[yb];tb(this,'/ajax/mercury/move_thread.php',zb);}.bind(this));var wb={action_type:m.CHANGE_FOLDER,action_id:null,thread_id:ub,new_folder:vb},xb={actions:[wb],from_client:true,payload_source:w.CLIENT_CHANGE_FOLDER};this.handleUpdate(xb);},changeMutingOnThread:function(ub,vb){p.isThreadID(ub);pa(this,ub,function(yb){tb(this,'/ajax/mercury/change_mute_thread.php',{thread_id:yb,mute_settings:vb,payload_source:la});}.bind(this));var wb={action_type:m.CHANGE_MUTE_SETTINGS,action_id:null,thread_id:ub,mute_settings:vb},xb={actions:[wb],from_client:true,payload_source:w.CLIENT_CHANGE_MUTE_SETTINGS};this.handleUpdate(xb);},markThreadSpam:function(ub){p.isThreadID(ub);pa(this,ub,function(xb){tb(this,'/ajax/mercury/mark_spam.php',{id:xb});}.bind(this));var vb={action_type:m.CHANGE_FOLDER,action_id:null,thread_id:ub,new_folder:ea.SPAM},wb={actions:[vb],from_client:true,payload_source:w.CLIENT_CHANGE_FOLDER};this.handleUpdate(wb);},markMessagesSpam:function(ub,vb){ba.getServerIDs(vb||[],function(xb){tb(this,'/ajax/mercury/mark_spam_messages.php',{message_ids:xb});}.bind(this));var wb={action_type:m.DELETE_MESSAGES,action_id:null,thread_id:ub,message_ids:vb};this.handleUpdate({actions:[wb],from_client:true,payload_source:w.CLIENT_DELETE_MESSAGES});},unmarkThreadSpam:function(ub){p.isThreadID(ub);pa(this,ub,function(xb){tb(this,'/ajax/mercury/unmark_spam.php',{id:xb});}.bind(this));var vb={action_type:m.CHANGE_FOLDER,action_id:null,thread_id:ub,new_folder:ea.INBOX},wb={actions:[vb],from_client:true,payload_source:w.CLIENT_CHANGE_FOLDER};this.handleUpdate(wb);},deleteThread:function(ub){p.isThreadID(ub);pa(this,ub,function(xb){var yb={ids:[xb]};tb(this,'/ajax/mercury/delete_thread.php',yb);}.bind(this));var vb={action_type:m.DELETE_THREAD,action_id:null,thread_id:ub},wb={actions:[vb],from_client:true,payload_source:w.CLIENT_DELETE_THREAD};this.handleUpdate(wb);},deleteMessages:function(ub,vb,wb){ba.getServerIDs(vb||[],function(yb){tb(this,'/ajax/mercury/delete_messages.php',{message_ids:yb});}.bind(this));var xb;if(wb){xb={action_type:m.DELETE_THREAD,action_id:null,thread_id:ub};}else xb={action_type:m.DELETE_MESSAGES,action_id:null,thread_id:ub,message_ids:vb};this.handleUpdate({actions:[xb],from_client:true,payload_source:w.CLIENT_DELETE_MESSAGES});},clearChat:function(ub,vb,wb){p.isThreadID(ub);tb(this,'/ajax/chat/settings.php',{clear_history_id:vb});var xb=[{action_type:m.CLEAR_CHAT,action_id:null,thread_id:ub,clear_time:wb}];this.handleUpdate({actions:xb,from_client:true,payload_source:w.CLIENT_CLEAR_CHAT});},sendNewMessage:function(ub,vb){vb=vb||la;if(!ub.client_state||ub.client_state==v.SEND_TO_SERVER)ba.getServerIDs(ub.forward_message_ids||[],function(xb){var yb=ub.thread_id,zb=this.tokenizeThreadID(ub.thread_id),ac=zb.type,bc=ia({},ub);bc.forward_message_ids=xb;if((ac=='root'&&zb.value==bc.message_id)||(ac=='user'&&!qa(this,yb))||(ub.thread_id==r.PENDING_THREAD_ID)){bc.client_thread_id=bc.thread_id;bc.thread_id=null;this._sendNewMessageToServer(bc,vb);}else pa(this,bc.thread_id,function(cc){bc.thread_id=cc;this._sendNewMessageToServer(bc);}.bind(this));}.bind(this));if(ub.thread_id!=r.PENDING_THREAD_ID){var wb={actions:[ia({},ub)],from_client:true,payload_source:w.CLIENT_SEND_MESSAGE};this.handleUpdate(wb);}},_sendNewMessageToServer:function(ub,vb){vb=vb||la;tb(this,'/ajax/mercury/send_messages.php',{message_batch:[ub],client:vb});},requestMessageConfirmation:function(ub,vb){vb=vb||la;var wb={},xb={};for(var yb in ub){var zb=qa(this,yb);if(zb){wb[zb]=ub[yb];}else{var ac=ub[yb];for(var bc=0;bc<ac.length;bc++)xb[ac[bc]]=yb;}}var cc=Object.keys(wb),dc=Object.keys(xb);if(cc.length||dc.length)tb(this,'/ajax/mercury/confirm_messages.php',{thread_message_map:wb,local_messages:xb,client:vb});},handleMessageConfirmError:function(ub){var vb=ub.getRequest().getData().thread_message_map,wb=ub.getRequest().getData().local_messages;if(!vb&&!wb)return;var xb=[];for(var yb in vb){var zb=vb[yb];zb.forEach(function(cc){xb.push({action_type:m.SEND_MESSAGE,client_message_id:cc,message_id:cc,client_thread_id:null,thread_id:yb,status:n.UNABLE_TO_CONFIRM});});}for(var ac in wb){var bc=wb[ac];xb.push({action_type:m.SEND_MESSAGE,client_message_id:ac,message_id:ac,client_thread_id:bc,thread_id:null,status:n.UNABLE_TO_CONFIRM});}if(xb.length)this.handleUpdate({actions:xb,payload_source:w.CLIENT_HANDLE_ERROR});},markSeen:function(){var ub=i.convertActionIDToTimestamp(this._lastActionId);tb(this,'/ajax/mercury/mark_seen.php',{seen_timestamp:ub});},handleRoger:function(ub){var vb=ub.tid?this._serverToClientIDs.getResource(ub.tid):('user:'+ub.reader);if(vb){var wb={};wb[vb]={};wb[vb]['fbid:'+ub.reader]=ub.time;this.inform('update-roger',wb);}},handleUpdateWaitForThread:function(ub,vb,wb){wb=wb||la;var xb=this._serverToClientIDs.getResource(vb);if(xb){this.handleUpdate(ub);return;}this._serverToClientIDs.executeOrEnqueue(vb,function(){this._pendingUpdates.push(ub);}.bind(this));if(!this._fetchingThreads[vb]){this._fetchingThreads[vb]=true;tb(this,'/ajax/mercury/thread_info.php',{threads:{thread_ids:[vb]},client:wb});}},handleUpdate:function(ub){var vb=[];if(ub&&ub.threads)for(var wb=0;wb<ub.threads.length;wb++){if(!ub.threads[wb].snippet_attachments)continue;for(var xb=0;xb<ub.threads[wb].snippet_attachments.length;xb++)if(ub.threads[wb].snippet_attachments[xb].share_xhp){vb.push({i:wb,j:xb,xhp:ub.threads[wb].snippet_attachments[xb].share_xhp});ub.threads[wb].snippet_attachments[xb].share_xhp="HTMLDivElement not shown: object contains circular "+"reference, which was breaking JSON.stringify. "+"Look at MercuryServerRequests.handleUpdate";}}ka.debug('handle_update',{payload:ub,from_client:ub.from_client});for(var yb=0;yb<vb.length;yb++)ub.threads[vb[yb].i].snippet_attachments[vb[yb].j].share_xhp=vb[yb].xhp;for(yb in ub){ha.getForFBID(this._fbid).synchronizeInforms(function(){if(!ub.from_client){xa(this,ub);this.inform('payload-preprocessed',ub);}this.inform('update-thread-ids',this._newlyAddedClientIDs);this._newlyAddedClientIDs={};this.inform('update-participants',ub);this.inform('update-threads',ub);this.inform('update-unread',ub);this.inform('update-threadlist',ub);this.inform('update-messages',ub);this.inform('update-unseen',ub);this.inform('update-typing-state',ub);this.inform('update-roger',ub.roger);this.inform('model-update-completed',null);ya(this);}.bind(this));break;}},_handleSendMessageErrorCommon:function(ub,vb,wb,xb){ka.debug('handle_send_message_error_common',{reliability_error_status:wb,request_error_status:vb});var yb=ub.getData(),zb=yb.message_batch,ac=zb.map(function(cc){return {action_type:m.SEND_MESSAGE,client_message_id:cc.message_id,message_id:cc.message_id,client_thread_id:cc.client_thread_id,thread_id:cc.thread_id,status:vb,error_data:xb};});ac.forEach(function(cc){ua(this,cc,wb);}.bind(this));var bc={actions:ac,payload_source:w.CLIENT_HANDLE_ERROR};this.handleUpdate(bc);},handleSendMessageError:function(ub){var vb=ub.getPayload(),wb=null,xb=null;if(vb&&vb.error_payload){wb=n.UNCONFIRMED;xb='send_error';}else{wb=n.ERROR;xb='request_error'+va(ub);}var yb=ub.error;if(yb===1404102)h.verboseErrorHandler(ub);var zb=/<.*>/.test(ub.getErrorDescription())?ub.getErrorSummary():ub.getErrorDescription();this._handleSendMessageErrorCommon(ub.getRequest(),wb,xb,{type:q.SERVER,code:ub.getError(),description:zb,is_transient:ub.isTransient()});},handleSendMessageTransportError:function(ub){this._handleSendMessageErrorCommon(ub.getRequest(),n.ERROR,'transport_error'+va(ub),{type:q.TRANSPORT,code:ub.getError(),is_transient:true});},handleSendMessageTimeout:function(ub){this._handleSendMessageErrorCommon(ub,n.ERROR,'transport_timeout',{type:q.TIMEOUT,is_transient:true});},getLastActionID:function(){return this._lastActionId;}});ia(gb,fa);function hb(ub){return {action_type:m.LOG_MESSAGE,thread_id:ub,message_id:ub,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:z.UNKNOWN,log_message_type:u.SERVER_ERROR,log_message_data:{}};}function ib(ub){var vb=ub.getData(),wb=vb.request_user_id?vb.request_user_id:j.user;return gb.getForFBID(wb);}function jb(ub,vb){ib(vb).handleUpdate(ub);}function kb(ub,vb){var wb=ub.client||vb.client;return {client:wb,message_batch:ub.message_batch.concat(vb.message_batch)};}function lb(ub,vb){var wb={};ia(wb,ub.ids);ia(wb,vb.ids);var xb=ub.client||vb.client;return {ids:wb,client:xb};}function mb(ub,vb){return vb;}function nb(ub){var vb=ib(ub.getRequest());vb.handleThreadInfoError(ub);}function ob(ub){var vb=ib(ub.getRequest());vb.handleSendMessageError(ub);}function pb(ub){var vb=ib(ub.getRequest());vb.handleSendMessageTransportError(ub);}function qb(ub){var vb=ib(ub);vb.handleSendMessageTimeout(ub);}function rb(ub){var vb=ib(ub.getRequest());vb.handleMessageConfirmError(ub);}function sb(ub){ga.registerEndpoints({'/ajax/mercury/thread_sync.php':{request_user_id:ub._fbid,mode:ga.IDEMPOTENT,handler:jb},'/ajax/mercury/thread_info.php':{request_user_id:ub._fbid,mode:ga.BATCH_DEFERRED_MULTI,batch_function:za,handler:jb,error_handler:nb},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE,handler:jb},'/ajax/mercury/change_read_status.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE,batch_function:lb,handler:jb},'/ajax/mercury/send_messages.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE,batch_function:kb,batch_size_limit:ca.SEND_BATCH_LIMIT,handler:jb,error_handler:ob,transport_error_handler:pb,timeout:y.sendMessageTimeout,timeout_handler:qb,connection_retries:ca.SEND_CONNECTION_RETRIES},'/ajax/mercury/mark_seen.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE,batch_function:mb,handler:jb},'/ajax/mercury/confirm_messages.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE,handler:jb,error_handler:rb},'/ajax/mercury/threadlist_info.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE_UNIQUE,batch_function:bb,handler:jb},'/ajax/mercury/mark_spam.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE,handler:jb},'/ajax/mercury/mark_spam_messages.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE,handler:jb},'/ajax/mercury/unmark_spam.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE,handler:jb},'/ajax/mercury/unread_threads.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE_UNIQUE,batch_function:ab,handler:jb},'/ajax/chat/settings.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE},'/ajax/mercury/change_archived_status.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE,batch_function:db,handler:jb},'/ajax/mercury/delete_thread.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE,batch_function:fb,handler:jb},'/ajax/mercury/delete_messages.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE,handler:jb},'/ajax/mercury/move_thread.php':{request_user_id:ub._fbid,mode:ga.BATCH_SUCCESSIVE,batch_function:eb,handler:jb},'/ajax/mercury/change_mute_thread.php':{request_user_id:ub._fbid,mode:ga.IMMEDIATE,handler:jb}});}function tb(ub,vb,wb,xb){ga.trySend(vb,wb,xb,ub._fbid);}e.exports=gb;});
__d("MercuryParticipants",["Env","ImageSourceRequest","ImageSourceType","MercuryAssert","MercuryIDs","MercuryParticipantTypes","MercuryParticipantsConstants","PhotoResizeModeConst","MercuryServerRequests","ShortProfiles","copyProperties","getObjectValues","tx"],function(a,b,c,d,e,f){var g=b('Env'),h=b('ImageSourceRequest'),i=b('ImageSourceType'),j=b('MercuryAssert'),k=b('MercuryIDs'),l=b('MercuryParticipantTypes'),m=b('MercuryParticipantsConstants'),n=b('PhotoResizeModeConst'),o=b('MercuryServerRequests').get(),p=b('ShortProfiles'),q=b('copyProperties'),r=b('getObjectValues'),s=b('tx'),t='fbid:'+g.user,u={},v={},w=function(ba){ba=z(ba);if(u[ba.id]){q(u[ba.id],ba);}else u[ba.id]=q({},ba);if(ba.vanity)v[ba.vanity]=ba.id;};function x(ba){j.isEmailParticipantID(ba);var ca=k.tokenize(ba),da=ca.value;return {gender:m.UNKNOWN_GENDER,href:null,id:ba,image_src:m.EMAIL_IMAGE,big_image_src:m.EMAIL_IMAGE,name:da,short_name:da,employee:false,call_promo:false};}function y(ba,ca,da){j.allParticipantIDs(ba);var ea={},fa={};ba.forEach(function(ha){if(u[ha]&&!da){ea[ha]=q({},u[ha]);}else{var ia=k.tokenize(ha);if(ia.type=='fbid'){var ja=ia.value;fa[ha]=ja;}else if(ia.type=='email')ea[ha]=x(ha);}});var ga=r(fa);if(ga.length){p.getMulti(ga,function(ha){for(var ia in fa){var ja=fa[ia],ka=ha[ja];ea[ia]={gender:ka.gender,href:ka.uri,id:ia,image_src:ka.thumbSrc,name:ka.name,short_name:ka.firstName,employee:ka.employee,call_promo:ka.showVideoPromo,type:ka.type,vanity:ka.vanity,is_friend:ka.is_friend,social_snippets:ka.social_snippets};w(ea[ia]);}ca(ea);});}else ca(ea);}function z(ba){var ca=ba.type===l.USER||ba.type===l.FRIEND;if(!ca)return ba;if(!ba.name&&!ba.href&&!ba.vanity){var da="Facebook User";ba.name=da;ba.short_name=da;}return ba;}var aa={user:t,isAuthor:function(ba){return ba===t;},getIDFromVanityOrFBID:function(ba){if(!ba)return;if(v[ba])return v[ba];if(ba.match('^\\d+$'))return aa.getIDForUser(ba);},getNow:function(ba){return u[ba];},get:function(ba,ca){j.isParticipantID(ba);aa.getMulti([ba],function(da){ca(da[ba]);});},getMulti:function(ba,ca,da){return y(ba,ca,false);},getMap:function(ba,ca){var da=[];for(var ea in ba)if(Array.isArray(ba[ea])){da=da.concat(ba[ea]);}else if(ba[ea])da.push(ba[ea]);this.getMulti(da,function(fa){var ga={};for(var ha in ba)if(Array.isArray(ba[ha])){ga[ha]=ba[ha].map(function(ia){return fa[ia];});}else ga[ha]=fa[ba[ha]];ca(ga);});},getBigImageMulti:function(ba,ca){j.allParticipantIDs(ba);var da=m.BIG_IMAGE_SIZE;aa.getMulti(ba,function(ea){var fa={},ga=0,ha=function(la,ma){ga++;fa[la]=ma;if(ga===ba.length)ca(fa);},ia=function(la,ma){u[la].big_image_src=ma.uri;ha(la,ma.uri);};for(var ja in ea){var ka=ea[ja];if(!ka.big_image_src){new h().setFBID(aa.getUserID(ja)).setType(i.PROFILE_PICTURE).setDimensions(da,da).setResizeMode(n.COVER).setCallback(ia.curry(ja)).send();}else ha(ka.id,ka.big_image_src);}});},getOrderedBigImageMulti:function(ba,ca){aa.getBigImageMulti(ba,function(da){var ea=ba.map(function(fa){return da[fa];});ca(ea);});},getMultiForceDownload:function(ba,ca){return y(ba,ca,true);},getUserID:function(ba){return k.getUserIDFromParticipantID(ba);},getIDForUser:function(ba){return 'fbid:'+ba;},addParticipants:function(ba){ba.forEach(w);}};o.subscribe('update-participants',function(ba,ca){aa.addParticipants(ca.participants||[]);});e.exports=aa;});
__d("MercuryFolders",["MessagingTag","arrayContains"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('arrayContains'),i=[g.INBOX,g.OTHER,g.ACTION_ARCHIVED,g.SPAM],j={getSupportedFolders:function(){return i.concat();},isSupportedFolder:function(k){return h(i,k);},getFromMeta:function(k){var l=k.folder;if(k.is_archived)l=g.ACTION_ARCHIVED;return l;}};e.exports=j;});
__d("MercuryAttachment",["MercuryAttachmentContentType","MercuryAttachmentType","startsWith"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentContentType'),h=b('MercuryAttachmentType'),i=b('startsWith'),j={getAttachIconClass:function(k){switch(k){case g.PHOTO:return 'MercuryPhotoIcon';case g.VIDEO:return 'MercuryVideoIcon';case g.MUSIC:return 'MercuryMusicIcon';case g.VOICE:return 'MercuryVoiceIcon';case g.TEXT:return 'MercuryTextIcon';case g.MSWORD:return 'MercuryMSWordIcon';case g.MSXLS:return 'MercuryMSXLSIcon';case g.MSPPT:return 'MercuryMSPPTIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(k){if(i(k,'image')){return 'MercuryPhotoIcon';}else if(i(k,'video')){return 'MercuryVideoIcon';}else if(i(k,'audio')){return 'MercuryMusicIcon';}else if(i(k,'text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(k){if(i(k,'image')){return g.PHOTO;}else if(i(k,'video')){return g.VIDEO;}else if(i(k,'audio')){return g.MUSIC;}else if(i(k,'text/plain')){return g.TEXT;}else return g.UNKNOWN;},convertRaw:function(k){var l=[];for(var m=0;m<k.length;m++){var n=k[m];if(n.attach_type===h.PHOTO){l.push(n);}else if(n.filename){var o=j.getAttachTypeByMime(n.filetype),p={};p.attach_type=h.FILE;p.name=n.filename;p.icon_type=o;p.url='';if(o==g.PHOTO)p.preview_loading=true;l.push(p);}}return l;},get:function(k){if(k.attachments){return k.attachments;}else if(k.raw_attachments){return this.convertRaw(k.raw_attachments);}else return [];}};e.exports=j;});
__d("MercuryThreads",["TimestampConverter","MercuryFolders","LogHistory","KeyedCallbackManager","MercuryActionTypeConstants","MercuryAssert","MercuryAttachment","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercurySingletonMixin","MercuryThreadMode","MessagingTag","MercuryParticipants","ReportState","MercuryServerRequests","MercuryThreadInformer","copyProperties","createObjectFrom","removeFromArray"],function(a,b,c,d,e,f){var g=b('TimestampConverter'),h=b('MercuryFolders'),i=b('LogHistory'),j=b('KeyedCallbackManager'),k=b('MercuryActionTypeConstants'),l=b('MercuryAssert'),m=b('MercuryAttachment'),n=b('MercuryGlobalActionType'),o=b('MercuryIDs'),p=b('MercuryLogMessageType'),q=b('MercurySingletonMixin'),r=b('MercuryThreadMode'),s=b('MessagingTag'),t=b('MercuryParticipants'),u=b('ReportState'),v=b('MercuryServerRequests'),w=b('MercuryThreadInformer'),x=b('copyProperties'),y=b('createObjectFrom'),z=b('removeFromArray'),aa=i.getInstance('mercury_threads');function ba(na,oa,pa){var qa=y(oa.participants,true),ra=t.getIDForUser(na._fbid);pa.forEach(function(sa){if(qa[sa]!==true){oa.participants.push(sa);if(sa===ra)oa.is_subscribed=true;}});}function ca(na,oa,pa){z(oa.participants,pa);if(pa===t.getIDForUser(na._fbid))oa.is_subscribed=false;}function da(na,oa){if(na.participants[0]!=oa){z(na.participants,oa);na.participants.unshift(oa);}}function ea(na,oa){var pa=oa.body,qa=oa.subject,ra='';if(qa){qa=qa.toLowerCase();if(pa.slice(0,qa.length).toLowerCase()==qa){ra=pa;}else if(pa){ra=qa+' \u00B7 '+pa;}else ra=qa;}else ra=pa;na.snippet=ra;na.snippet_has_attachment=oa.has_attachment;if(oa.raw_attachments&&oa.raw_attachments.length>0){var sa=m.convertRaw(oa.raw_attachments);na.snippet_attachments=sa;}else na.snippet_attachments=oa.attachments;na.is_forwarded_snippet=!!oa.forward_count;na.snippet_sender=oa.author;}function fa(na,oa,pa){if(!oa)return false;if(!oa.timestamp)return true;var qa=!oa.unread_count;if(pa==qa)return false;oa.unread_count=pa?0:1;na._threadInformer.updatedThread(oa.thread_id);return true;}function ga(na,oa){var pa=na._threads.getAllResources();for(var qa in pa){var ra=pa[qa];if(ra.folder==oa){ra.unread_count=0;na._threads.setResource(qa,ra);na._threadInformer.updatedThread(qa);}}}function ha(na,oa,pa){if(!oa||oa.chat_clear_time===pa)return false;oa.chat_clear_time=pa;na._threadInformer.reorderedMessages(oa.thread_id);return true;}function ia(na,oa,pa,qa){var ra=pa.action_type;if(ra==k.USER_GENERATED_MESSAGE||ra==k.LOG_MESSAGE){pa.is_unread&&oa.unread_count++;oa.message_count++;oa.is_archived=false;}switch(ra){case k.USER_GENERATED_MESSAGE:da(oa,pa.author);break;case k.SEND_MESSAGE:var sa=pa.log_message_type;if(sa==p.THREAD_IMAGE)oa.image_src=pa.log_message_data.image?pa.log_message_data.image.preview_url:null;oa.snippet_attachments=pa.attachments;break;case k.LOG_MESSAGE:var sa=pa.log_message_type;if(sa==p.SUBSCRIBE){ba(na,oa,pa.log_message_data.added_participants);}else if(sa==p.JOINABLE_JOINED){ba(na,oa,[pa.log_message_data.joined_participant]);}else if(sa==p.UNSUBSCRIBE){ca(na,oa,pa.author);}else if(sa==p.THREAD_IMAGE){if(!qa)oa.image_src=pa.log_message_data.image?pa.log_message_data.image.preview_url:null;}else if(sa==p.THREAD_NAME)oa.name=pa.log_message_data.name;break;case k.CHANGE_READ_STATUS:if(pa.timestamp)na._threadInformer.changedThreadReadState(oa.thread_id,pa.mark_as_read,pa.timestamp);fa(na,oa,pa.mark_as_read);break;case k.CLEAR_CHAT:ha(na,oa,pa.clear_time);break;case k.CHANGE_ARCHIVED_STATUS:oa.is_archived=pa.archived;break;case k.CHANGE_FOLDER:oa.folder=pa.new_folder;break;case k.DELETE_MESSAGES:if(qa){oa.snippet='...';oa.snippet_has_attachment=false;oa.snippet_attachments=null;oa.snippet_sender=null;oa.is_forwarded_snippet=false;na._threadInformer.updatedThread(pa.thread_id);}else if(pa.message_ids)oa.message_count=oa.message_count-pa.message_ids.length;break;case k.CHANGE_MUTE_SETTINGS:if(pa.mute_settings!==undefined){var ta=na._fbid+'@facebook.com';if(oa.mute_settings){if(pa.mute_settings){oa.mute_settings[ta]=pa.mute_settings;}else delete oa.mute_settings[ta];na._threadInformer.updatedThread(oa.thread_id);}}break;}if(pa.action_id)oa.last_action_id=g.maxValidActionID(pa.action_id,oa.last_action_id);}function ja(na,oa){var pa=na._serverRequests.tokenizeThreadID(oa.thread_id);if(pa.type=='group'){aa.error('invalid_new_thread_message',oa);return undefined;}var qa=la(na,oa.specific_to_list),ra={thread_id:oa.thread_id,last_action_id:oa.action_id,participants:oa.specific_to_list,name:null,snippet:oa.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:oa.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:oa.timestamp_absolute,timestamp_relative:oa.timestamp_relative,timestamp:oa.timestamp,canonical_fbid:pa.type==='user'?pa.value:null,is_canonical_user:pa.type==='user',is_canonical:qa,is_subscribed:true,root_message_threading_id:oa.message_id,folder:s.INBOX,is_archived:false,mode:r.TITAN_ORIGINATED};return ra;}function ka(na){this._fbid=na;this._serverRequests=v.getForFBID(this._fbid);this._threadInformer=w.getForFBID(this._fbid);this._threads=new j();ma(this);}x(ka.prototype,{getThreadMetaNow:function(na){l.isThreadID(na);return this._threads.getResource(na);},getThreadMeta:function(na,oa,pa){var qa=function(ra){oa(ra[na]);};return this.getMultiThreadMeta([na],qa,pa);},getMultiThreadMeta:function(na,oa,pa){l.allThreadID(na);var qa=this._threads.executeOrEnqueue(na,oa),ra=this._threads.getUnavailableResources(qa);if(ra.length){var sa=[];for(var ta=0;ta<ra.length;ta++){var ua=ra[ta],va=this._serverRequests.tokenizeThreadID(ua);if(va.type=='user'){var wa=this.getCanonicalThreadToUser(va.value,null,pa,true);if(this.isEmptyLocalThread(wa.thread_id))sa.push(wa.thread_id);}else sa.push(ua);}if(sa.length)this._serverRequests.fetchThreadData(sa,pa);}return qa;},unsubscribe:function(na){this._threads.unsubscribe(na);},changeThreadReadStatus:function(na,oa){l.isThreadID(na);var pa=this._threads.getResource(na);if(fa(this,pa,oa))this._serverRequests.changeThreadReadStatus(na,oa,h.getFromMeta(pa));},changeThreadArchivedStatus:function(na,oa){l.isThreadID(na);var pa=this._threads.getResource(na);if(pa.is_archived!=oa){pa.is_archived=oa;this._threadInformer.updatedThread(pa.thread_id);this._serverRequests.changeThreadArchivedStatus(na,oa);}},markThreadSpam:function(na){this._serverRequests.markThreadSpam(na);},unmarkThreadSpam:function(na){this._serverRequests.unmarkThreadSpam(na);},updateThreadMuteSetting:function(na,oa){this._serverRequests.changeMutingOnThread(na,oa);},changeFolder:function(na,oa){l.isThreadID(na);var pa=this._threads.getResource(na);if(pa&&pa.folder!=oa){pa.folder=oa;this._threadInformer.updatedThread(pa.thread_id);this._serverRequests.changeThreadFolder(na,oa);}},deleteThread:function(na){l.isThreadID(na);this._serverRequests.deleteThread(na);},updateThreads:function(na){if(!na||!na.length)return;var oa={};na.forEach(function(pa){oa[pa.thread_id]=pa;});this._threads.addResourcesAndExecute(oa);},updateMetadataByActions:function(na,oa){if(!na||!na.length)return;var pa={},qa={},ra={};for(var sa=0;sa<na.length;sa++){var ta=na[sa];if(ta.is_forward)continue;var ua=ta.action_type,va=ta.thread_id;l.isThreadID(va);var wa=this.getThreadMetaNow(va);if(ua==k.LOG_MESSAGE&&ta.log_message_type==p.SERVER_ERROR)continue;if(!wa&&!ta.action_id&&ua==k.USER_GENERATED_MESSAGE){wa=ja(this,ta);this._threads.setResource(va,wa);}if(wa){if(ua==k.DELETE_THREAD){wa.message_count=0;this._threadInformer.deletedThread(va);continue;}var xa=!!ta.action_id;if(ua==k.LOG_MESSAGE||ua==k.USER_GENERATED_MESSAGE)xa=!oa;if(wa.server_timestamp&&ta.timestamp<=wa.server_timestamp&&xa)continue;if(!ra[va])ra[va]=x({},wa);ia(this,ra[va],ta,oa);if(ua==k.USER_GENERATED_MESSAGE)pa[va]=ta;if(ua==k.USER_GENERATED_MESSAGE||ua==k.LOG_MESSAGE||ua==k.SEND_MESSAGE)if(ta&&ta.timestamp&&(!qa[va]||ta.timestamp>qa[va].timestamp))qa[va]=ta;}}for(var ya in ra){var za=ra[ya],ab=pa[ya];if(ab)ea(za,ab);var bb=qa[ya],cb=za.timestamp;if(bb){if(bb.timestamp>cb)za=x(za,{timestamp_absolute:bb.timestamp_absolute,timestamp_relative:bb.timestamp_relative,timestamp:bb.timestamp});var db=za.server_timestamp;if(!oa&&bb.timestamp>db)za.server_timestamp=bb.timestamp;}this._threads.setResource(ya,za);}},getCanonicalThreadToUser:function(na,oa,pa,qa){return this.getCanonicalThreadToParticipant('fbid:'+na,oa,pa,qa);},getCanonicalThreadToParticipant:function(na,oa,pa,qa){var ra=this.getThreadIDForParticipant(na),sa=this._threads.getResource(ra);if(typeof sa=='undefined'){sa=this.createNewLocalThread(ra,[t.getIDForUser(this._fbid),na],oa);!qa&&this._serverRequests.fetchThreadData([ra],pa);}return sa;},getThreadIdForUser:function(na){return 'user:'+na;},getThreadIDForParticipant:function(na){var oa=o.tokenize(na);return this.getThreadIdForUser(oa.value);},createNewLocalThread:function(na,oa,pa){var qa=this._threads.getResource(na);if(!qa){var ra=this._serverRequests.tokenizeThreadID(na);qa={thread_id:na,last_action_id:null,participants:oa,name:null,snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:pa?pa:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,canonical_fbid:ra.type==='user'?ra.value:null,is_canonical_user:ra.type=='user',is_canonical:la(this,oa),is_subscribed:true,root_message_threading_id:null,folder:s.INBOX,is_archived:false,mode:r.TITAN_ORIGINATED};this._threads.setResource(na,qa);}return qa;},addParticipantsToThreadLocally:function(na,oa){var pa=this._threads.getResource(na);if(pa){ba(this,pa,oa);this._threadInformer.updatedThread(pa.thread_id);}},getCanonicalUserInThread:function(na){var oa=this._serverRequests.tokenizeThreadID(na);return oa.type=='user'?oa.value:null;},getCanonicalGroupInThread:function(na){var oa=this._serverRequests.tokenizeThreadID(na);return oa.type=='group'?oa.value:null;},isEmptyLocalThread:function(na){var oa=this._threads.getResource(na);if(!oa)return false;var pa=this._serverRequests.tokenizeThreadID(na);return pa.type=='root'&&!oa.timestamp;},isNewEmptyLocalThread:function(na){if(!this.isEmptyLocalThread(na))return false;var oa=this._threads.getResource(na);return oa.participants&&oa.participants.length===0;},canReply:function(na){var oa=this._threads.getResource(na);return oa&&oa.is_subscribed&&oa.mode!=r.OBJECT_ORIGINATED&&(oa.recipients_loadable||oa.recipients_loadable===undefined);}});x(ka,q);function la(na,oa){var pa=oa.filter(function(qa){return qa!=t.getIDForUser(na._fbid);});return pa.length<=1;}function ma(na){na._serverRequests.subscribe('update-threads',function(oa,pa){var qa=(pa.actions||[]).filter(function(ua){return ua.thread_id;});na.updateThreads(pa.threads);na.updateMetadataByActions(qa,pa.from_client);(pa.threads||[]).forEach(function(ua){na._threadInformer.updatedThread(ua.thread_id);});var ra=pa.global_actions||[];for(var sa=0;sa<ra.length;sa++){var ta=ra[sa];if(ta.action_type==n.MARK_ALL_READ)ga(na,ta.folder);}});}u.registerCallback('mercury-threads',function(){var na={};na.threads={};var oa=ka._getInstances();for(var pa in oa)na.threads[pa]=oa[pa]._threads.dumpResources();return na;});e.exports=ka;});
__d("MercuryUnreadState",["MercuryFolders","LogHistory","KeyedCallbackManager","MercuryActionTypeConstants","MercuryGlobalActionType","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('MercuryFolders'),h=b('LogHistory'),i=b('KeyedCallbackManager'),j=b('MercuryActionTypeConstants'),k=b('MercuryGlobalActionType'),l=b('MercurySingletonMixin'),m=b('MercuryThreadlistConstants'),n=b('MessagingTag'),o=b('ReportState'),p=b('MercuryServerRequests'),q=b('MercuryThreadInformer'),r=b('MercuryThreads'),s=b('arrayContains'),t=b('copyProperties'),u=b('createObjectFrom'),v=(g.getSupportedFolders()||[]).filter(function(ma){return ma!=n.ACTION_ARCHIVED;}),w='unread_thread_hash',x='unseen_thread_list',y=m.MAX_UNREAD_COUNT,z=h.getInstance('mercury_unread_state');function aa(ma){this._fbid=ma;this._serverRequests=p.getForFBID(this._fbid);this._threadInformer=q.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};v.forEach(function(na){this._initialUnreadCount[na]=0;this._maxCount[na]=false;this._unreadResources[na]=new i();}.bind(this));this._serverRequests.subscribe('update-unread',function(na,oa){fa(this,oa);var pa=oa.global_actions||[];for(var qa=0;qa<pa.length;qa++){var ra=pa[qa];if(ra.action_type==k.MARK_ALL_READ)ia(this,ra.folder,ra.timestamp);}}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(na,oa){ka(this,oa);}.bind(this));}t(aa.prototype,{getUnreadCount:function(ma){if(this.exceedsMaxCount(ma)){z.error('unguarded_unread_count_fetch',{});return 0;}return ea(this,ma);},exceedsMaxCount:function(ma){return this._maxCount[ma]||(ea(this,ma)>y);},markFolderAsRead:function(ma){if(this._maxCount[ma]||ea(this,ma)>0)this._serverRequests.markFolderAsRead(ma);}});t(aa,l);function ba(ma,na,oa){ma._unreadResources[na].setResource(w,oa);ma._unreadResources[na].setResource(x,Object.keys(oa));}function ca(ma,na,oa){var pa=ma._unreadResources[na].executeOrEnqueue(w,oa),qa=ma._unreadResources[na].getUnavailableResources(pa);if(qa.length)ma._serverRequests.fetchUnreadThreadIDs(na);}function da(ma,na){return ma._unreadResources[na].getResource(w);}function ea(ma,na){var oa=ma._unreadResources[na].getResource(x);if(oa){return oa.length;}else return ma._initialUnreadCount[na];}function fa(ma,na){var oa;(na.unread_thread_ids||[]).forEach(function(pa){oa=pa.folder;if(!la(oa))return;var qa=ja(ma,pa.thread_ids);ba(ma,oa,u(qa,true));if(qa.length>y)ma._maxCount[oa]=true;ma._threadInformer.updatedUnreadState();});(na.message_counts||[]).forEach(function(pa){if(pa.unread_count===undefined)return;oa=pa.folder;if(pa.unread_count>y){ma._maxCount[oa]=true;ba(ma,oa,{});ma._threadInformer.updatedUnreadState();}else{ma._initialUnreadCount[oa]=pa.unread_count;if(ma._initialUnreadCount[oa]===0)ba(ma,oa,{});ma._threadInformer.updatedUnreadState();}});(na.actions||[]).forEach(function(pa){if(pa.is_forward)return;var qa=j,ra=pa.thread_id?pa.thread_id:pa.server_thread_id;if(pa.action_type==qa.DELETE_THREAD){v.forEach(function(ta){ha(ma,ta,ra);});}else if(pa.action_type==qa.CHANGE_ARCHIVED_STATUS||pa.action_type==qa.CHANGE_FOLDER){var sa=ma._threads.getThreadMetaNow(pa.thread_id);oa=g.getFromMeta(sa);if(la(oa)&&sa.unread_count>0)ga(ma,oa,ra);v.forEach(function(ta){if(ta!=oa)ha(ma,ta,ra);});}else{oa=pa.folder;if(!la(oa))return;if(pa.action_type==qa.CHANGE_READ_STATUS){if(pa.mark_as_read){ha(ma,oa,ra,pa.timestamp);}else ga(ma,oa,ra,pa.timestamp);}else if(pa.action_type==qa.USER_GENERATED_MESSAGE||pa.action_type==qa.LOG_MESSAGE)if(pa.is_unread)ga(ma,oa,ra,pa.timestamp);}});}function ga(ma,na,oa,pa){if(ma._maxCount[na])return;ca(ma,na,function(qa){var ra=ma._allReadTimestamp[na]||0,sa=ma._threadReadTimestamp[oa]||0,ta=pa||Number.POSITIVE_INFINITY;if(ta>=ra&&ta>=sa&&!qa[oa]){qa[oa]=pa||0;ba(ma,na,qa);ma._threadInformer.updatedUnreadState();}});}function ha(ma,na,oa,pa){if(ma._maxCount[na])return;ca(ma,na,function(qa){if(pa){var ra=ma._threadReadTimestamp[oa];if(!ra||ra<pa)ma._threadReadTimestamp[oa]=pa;}var sa=qa[oa];if(pa&&typeof sa=='number'&&pa<sa)return;if(oa in qa){delete qa[oa];ba(ma,na,qa);ma._threadInformer.updatedUnreadState();}});}function ia(ma,na,oa){ma._maxCount[na]=false;ba(ma,na,{});ma._allReadTimestamp[na]=Math.max(ma._allReadTimestamp[na]||0,oa||0);ma._threadInformer.updatedUnreadState();}function ja(ma,na){return na.map(ma._serverRequests.convertThreadIDIfAvailable.bind(ma._serverRequests));}function ka(ma,na){v.forEach(function(oa){var pa=da(ma,oa);if(!pa)return;for(var qa in na){var ra=na[qa];if(pa[qa]){pa[ra]=pa[qa];delete pa[qa];}}ba(ma,oa,pa);});}function la(ma){return s(v,ma);}o.registerCallback('mercury-unread-state',function(){var ma={};ma.unread={};ma.unread_max_count={};var na=aa._getInstances();for(var oa in na){ma.unread[oa]={};ma.unread_max_count[oa]={};v.forEach(function(pa){ma.unread[oa][pa]=t({},da(na[oa],pa));ma.unread_max_count[oa][pa]=na[oa]._maxCount[pa];});}return ma;});e.exports=aa;});
__d("MercuryChatUtils",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h={canOpenChatTab:function(i){var j=i.is_canonical&&!i.is_canonical_user;return i.is_subscribed&&!j&&i.canonical_fbid!=g.user;}};e.exports=h;});
__d("RenderManager",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties');function h(i){this._isDirty=false;this._obj=i;}h.prototype.dirty=function(){if(!this._isDirty){this._isDirty=true;this._doPaint.bind(this).defer();}};h.prototype._doPaint=function(){this._isDirty=false;this._obj.paint();};e.exports=h;});
__d("CounterDisplay",["Arbiter","CSS","DOM","RenderManager","Run","$","copyProperties","removeFromArray"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('RenderManager'),k=b('Run'),l=b('$'),m=b('copyProperties'),n=b('removeFromArray');function o(p,q,r,s,t,u){m(this,{_name:p,_valueNode:l(q),_wrapperNode:l(r)||null,_statusClass:t,_rm:new j(this),_arbiterSubscription:null,_count:0});var v=this._valueNode.firstChild;if(v){var w=parseInt(v.nodeValue,10);if(!isNaN(w))this._count=w;}this._statusNode=s?l(s):null;this._subscribeAll();o.instances.push(this);if(!u)k.onLeave(this._destroy.bind(this),true);}m(o,{EVENT_TYPE_ADJUST:'CounterDisplay/adjust',EVENT_TYPE_UPDATE:'CounterDisplay/update',instances:[],adjustCount:function(p,q){g.inform(o.EVENT_TYPE_ADJUST+'/'+p,q);},setCount:function(p,q){g.inform(o.EVENT_TYPE_UPDATE+'/'+p,q);}});m(o.prototype,{_destroy:function(){delete this._valueNode;delete this._wrapperNode;if(this._arbiterSubscription){this._arbiterSubscription.unsubscribe();delete this._arbiterSubscription;}n(o.instances,this);},adjustCount:function(p){this._count=Math.max(0,this._count+p);this._rm.dirty();return this;},setCount:function(p){this._count=Math.max(0,p);this._rm.dirty();return this;},paint:function(){i.setContent(this._valueNode,this._count);this._toggleNodes();},_toggleNodes:function(){if(this._wrapperNode)h.conditionClass(this._wrapperNode,'hidden_elem',this._count<=0);if(this._statusClass&&this._statusNode)h.conditionClass(this._statusNode,this._statusClass,this._count>0);},_subscribeAll:function(){var p=[o.EVENT_TYPE_ADJUST+'/'+this._name,o.EVENT_TYPE_UPDATE+'/'+this._name];this._arbiterSubscription=g.subscribe(p,this._onInform.bind(this),g.SUBSCRIBE_NEW);},_onInform:function(p,q){q=parseInt(q);if(isNaN(q))return;if(p.indexOf(o.EVENT_TYPE_ADJUST)!=-1){this.adjustCount(q);}else if(p.indexOf(o.EVENT_TYPE_UPDATE)!=-1){this.setCount(q);}else return;return;}});e.exports=o;});
__d("BasicTypeaheadRenderer",["BadgeHelper","DOM"],function(a,b,c,d,e,f){var g=b('BadgeHelper'),h=b('DOM');function i(j,k){var l=[];if(j.icon)l.push(h.create('img',{alt:'',src:j.icon}));if(j.text){var m=[j.text];if(j.verified)m.push(g.renderBadge('xsmall','verified'));l.push(h.create('span',{className:'text'},m));}if(j.subtext)l.push(h.create('span',{className:'subtext'},[j.subtext]));var n=h.create('li',{className:j.type||''},l);if(j.text)n.setAttribute('aria-label',j.text);return n;}i.className='basic';e.exports=i;});
__d("TypeaheadView",["ArbiterMixin","BasicTypeaheadRenderer","CSS","DOM","Event","Parent","$","copyProperties","emptyFunction","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('BasicTypeaheadRenderer'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Parent'),m=b('$'),n=b('copyProperties'),o=b('emptyFunction'),p=b('mixin'),q=p(g);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u,v){this.element=this.content=m(u);this.showBadges=v.showBadges;n(this,v);}t.prototype.init=function(){this.init=o;this.initializeEvents();this.reset();};t.prototype.initializeEvents=function(){k.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});};t.prototype.setTypeahead=function(u){this.typeahead=u;};t.prototype.setAccessibilityControlElement=function(u){this.accessibilityElement=u;};t.prototype.getElement=function(){return this.element;};t.prototype.mouseup=function(event){if(event.button!=2){this.select(true);event.kill();}};t.prototype.mouseover=function(event){if(this.ignoreMouseover){this.ignoreMouseover=false;return;}if(this.visible)this.highlight(this.getIndex(event));};t.prototype.reset=function(u){if(!u)this.disableAutoSelect=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;};t.prototype.getIndex=function(event){return this.items.indexOf(l.byTag(event.getTarget(),'li'));};t.prototype.getSelection=function(){var u=this.results[this.index]||null;return this.visible?u:null;};t.prototype.isEmpty=function(){return !this.results.length;};t.prototype.isVisible=function(){return !!this.visible;};t.prototype.show=function(){i.show(this.element);if(this.results&&this.results.length)if(this.autoSelect&&this.accessibilityElement&&this.selected)this.accessibilityElement.setAttribute('aria-activedescendant',j.getID(this.selected));this.accessibilityElement&&this.accessibilityElement.setAttribute('aria-expanded','true');this.visible=true;return this;};t.prototype.hide=function(){i.hide(this.element);if(this.accessibilityElement){this.accessibilityElement.setAttribute('aria-expanded','false');this.accessibilityElement.removeAttribute('aria-activedescendant');}this.visible=false;return this;};t.prototype.render=function(u,v){this.value=u;if(!v.length){this.accessibilityElement&&this.accessibilityElement.removeAttribute('aria-activedescendant');this.reset(true);return;}var w={results:v,value:u};this.inform('beforeRender',w);v=w.results;var x=this.getDefaultIndex(v);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)&&this.index<this.results.length){var y=this.results[this.index];for(var z=0,aa=v.length;z<aa;++z)if(y.uid==v[z].uid){x=z;break;}}this.results=v;j.setContent(this.content,this.buildResults(v));this.items=this.getItems();this.highlight(x,false);this.inform('render',v);};t.prototype.getItems=function(){return j.scry(this.content,'li');};t.prototype.buildResults=function(u){var v,w=null;if(typeof this.renderer=='function'){v=this.renderer;w=this.renderer.className||'';}else{v=a.TypeaheadRenderers[this.renderer];w=this.renderer;}v=v.bind(this);var x=this.showBadges,y=u.map(function(aa,ba){if(!x)aa.verified=null;var ca=aa.node||v(aa,ba);ca.setAttribute('role','option');return ca;}),z=j.create('ul',{className:w,id:'typeahead_list_'+(this.typeahead?j.getID(this.typeahead):j.getID(this.element))},y);z.setAttribute('role','listbox');return z;};t.prototype.getDefaultIndex=function(){var u=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!u?-1:0;};t.prototype.next=function(){this.highlight(this.index+1);this.inform('next',this.selected);};t.prototype.prev=function(){this.highlight(this.index-1);this.inform('prev',this.selected);};t.prototype.getItemText=function(u){var v='';if(u){v=u.getAttribute('aria-label');if(!v){v=j.getText(u);u.setAttribute('aria-label',v);}}return v;};t.prototype.setIsViewingSelectedItems=function(u){this.viewingSelected=u;return this;};t.prototype.getIsViewingSelectedItems=function(){return !!this.viewingSelected;};t.prototype.highlight=function(u,v){if(this.selected){i.removeClass(this.selected,'selected');this.selected.setAttribute('aria-selected','false');}if(u>this.items.length-1){u=-1;}else if(u<-1)u=this.items.length-1;if(u>=0&&u<this.items.length){this.selected=this.items[u];i.addClass(this.selected,'selected');this.selected.setAttribute('aria-selected','true');if(this.accessibilityElement)(function(){this.accessibilityElement.setAttribute('aria-activedescendant',j.getID(this.selected));}).bind(this).defer();}else this.accessibilityElement&&this.accessibilityElement.removeAttribute('aria-activedescendant');this.index=u;this.disableAutoSelect=(u==-1);if(v!==false)this.inform('highlight',{index:u,selected:this.results[u],element:this.selected});};t.prototype.select=function(u){var v=this.index,w=this.results[v],x=this.element.getAttribute('id');if(w){this.inform('select',{index:v,clicked:!!u,selected:w,id:x,query:this.value});this.inform('afterSelect');}};n(t.prototype,{events:['highlight','render','reset','select','beforeRender','next','prev'],renderer:h,autoSelect:false,ignoreMouseover:false});e.exports=t;});
__d("ContextualTypeaheadView",["BucketedTypeaheadView","CSS","ContextualLayer","ContextualLayerAutoFlip","ContextualLayerHideOnScroll","DOM","DOMDimensions","Style"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('CSS'),i=b('ContextualLayer'),j=b('ContextualLayerAutoFlip'),k=b('ContextualLayerHideOnScroll'),l=b('DOM'),m=b('DOMDimensions'),n=b('Style');for(var o in g)if(g.hasOwnProperty(o))q[o]=g[o];var p=g===null?null:g.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=g;function q(){if(g!==null)g.apply(this,arguments);}q.prototype.init=function(){this.initializeLayer();p.init.call(this);};q.prototype.initializeLayer=function(){this.context=this.getContext();this.wrapper=l.create('div');l.appendContent(this.wrapper,this.element);h.addClass(this.element,'uiContextualTypeaheadView');this.layer=new i({context:this.context,position:'below',alignment:this.alignment,causalElement:this.causalElement,permanent:true},this.wrapper);this.layer.enableBehavior(k);if(n.isFixed(this.context)||this.autoflip)this.layer.enableBehavior(j);this.subscribe('render',this.renderLayer.bind(this));};q.prototype.show=function(){if(this.minWidth){n.set(this.wrapper,'min-width',this.minWidth+'px');}else if(this.width){n.set(this.wrapper,'width',this.width+'px');}else n.set(this.wrapper,'width',m.getElementDimensions(this.context).width+'px');var r=p.show.call(this);this.layer.show();return r;};q.prototype.hide=function(){this.layer.hide();return p.hide.call(this);};q.prototype.renderLayer=function(){if(!this.isVisible())return;if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();};q.prototype.clearText=function(){this.layer.getCausalElement().value='';};q.prototype.getContext=function(){return this.element.parentNode;};e.exports=q;});
__d("DOMClone",[],function(a,b,c,d,e,f){var g={shallowClone:function(i){return h(i,false);},deepClone:function(i){return h(i,true);}};function h(i,j){var k=i.cloneNode(j);if(typeof k.__FB_TOKEN!=='undefined')delete k.__FB_TOKEN;return k;}e.exports=g;});
__d("FileInput",["ArbiterMixin","DOM","DOMClone","Event","Focus","UserAgent","cx","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('DOMClone'),j=b('Event'),k=b('Focus'),l=b('UserAgent'),m=b('cx'),n=l.ie(),o=b("mixin"),p=o(g);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u,v){this.container=t;this.control=u;var w=h.scry(this.container,'a')[0];w&&w.removeAttribute('href');var x=h.create('div',{className:"_3jk"},v);h.appendContent(this.control,x);this._boundHandleChange=this._handleChange.bind(this);this._setInputElement(v);}s.prototype.getValue=function(){return this.input.value;};s.prototype.getInput=function(){return this.input;};s.prototype.clear=function(){if(n){var t=i.deepClone(this.input);h.replace(this.input,t);this._setInputElement(t);}else this.input.value='';};s.prototype.destroy=function(){this._listener.remove();this._listener=null;this.container=null;this.control=null;this.input=null;};s.prototype._setInputElement=function(t){this.input=t;k.relocate(t,this.control);this._listener&&this._listener.remove();this._listener=j.listen(t,'change',this._boundHandleChange);};s.prototype._handleChange=function(event){this.inform('change',event);var t=this.input.form;if(t&&n<9)j.fire(t,'change',event);};e.exports=s;});
__d("Typeahead",["ArbiterMixin","BehaviorsMixin","DataStore","DOM","Event","Parent","Run","emptyFunction","ge","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('DataStore'),j=b('DOM'),k=b('Event'),l=b('Parent'),m=b('Run'),n=b('emptyFunction'),o=b('ge'),p=b('mixin'),q=p(g,h);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u,v,w,x){this.args={data:u,view:v,core:w};i.set(x,'Typeahead',this);this.element=x;}t.prototype.init=function(u){this.init=n;this.getCore();this.getView().setAccessibilityControlElement(this.getCore().getElement());this.proxyEvents();this.initBehaviors(u||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();};t.prototype.getData=function(){if(!this.data){var u=this.args.data;this.data=u;this.data.init();}return this.data;};t.prototype.getView=function(){if(!this.view){var u=this.args.view,v=u.node||o(u.node_id);if(!v){v=j.create('div',{className:'uiTypeaheadView'});j.appendContent(this.element,v);}if(typeof u.ctor==='string'){this.view=new window[u.ctor](v,u.options||{});}else this.view=new u.ctor(v,u.options||{});this.view.init();this.view.setTypeahead(this.element);}return this.view;};t.prototype.getCore=function(){if(!this.core){var u=this.args.core;if(typeof u.ctor==='string'){this.core=new window[u.ctor](u.options||{});}else this.core=new u.ctor(u.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;};t.prototype.getElement=function(){return this.element;};t.prototype.swapData=function(u){var v=this.core;this.data=this.args.data=u;u.init();if(v){v.data=u;v.initData();v.reset();}u.bootstrap();return u;};t.prototype.proxyEvents=function(){[this.data,this.view,this.core].forEach(function(u){u.subscribe(u.events,this.inform.bind(this));},this);};t.prototype.initBehaviors=function(u){u.forEach(function(v){if(typeof v==='string'){if(a.TypeaheadBehaviors&&a.TypeaheadBehaviors[v]){a.TypeaheadBehaviors[v](this);}else m.onLoad(function(){if(a.TypeaheadBehaviors)(a.TypeaheadBehaviors[v]||n)(this);}.bind(this));}else this.enableBehavior(v);},this);};t.getInstance=function(u){var v=l.byClass(u,'uiTypeahead');return v?i.get(v,'Typeahead'):null;};t.initNow=function(u,v,w){if(w)w.init(u);u.init(v);};t.init=function(u,v,w,x){if(!j.isNodeOfType(u,['input','textarea']))u=j.scry(u,'input')[0]||j.scry(u,'textarea')[0];var y=false;try{y=document.activeElement===u;}catch(z){}if(y){t.initNow(v,w,x);}else var aa=k.listen(u,'focus',function(){t.initNow(v,w,x);aa.remove();});};e.exports=t;});
__d("TypeaheadCore",["Arbiter","ArbiterMixin","CSS","DOM","Event","Focus","Input","InputSelection","Keys","StickyPlaceholderInput","UserAgent","bind","copyProperties","emptyFunction","mixin"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Focus'),m=b('Input'),n=b('InputSelection'),o=b('Keys'),p=b('StickyPlaceholderInput'),q=b('UserAgent'),r=b('bind'),s=b('copyProperties'),t=b('emptyFunction'),u=b('mixin'),v=u(h);for(var w in v)if(v.hasOwnProperty(w))y[w]=v[w];var x=v===null?null:v.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=v;function y(z){s(this,z);}y.prototype.init=function(z,aa,ba){this.init=t;this.data=z;this.view=aa;this.root=ba;this.initInput();this.inputWrap=j.find(ba,'div.wrap');this.hiddenInput=j.find(ba,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&i.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];};y.prototype.initInput=function(){this.element=j.find(this.root,'.textInput');var z=j.scry(this.element,'input')[0];if(z)this.element=z;};y.prototype.initView=function(){this.view.subscribe('highlight',l.set.curry(this.element));this.view.subscribe('select',function(z,aa){this.select(aa.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));};y.prototype.initData=function(){this.data.subscribe('respond',function(z,aa){if(aa.forceDisplay||aa.value==this.getValue()&&!this.element.disabled)this.view.render(aa.value,aa.results,aa.isAsync);}.bind(this));this.data.subscribe('activity',function(z,aa){this.fetching=aa.activity;if(!this.fetching)this.nextQuery&&this.performQuery();if(this.loading!=this.fetching){this.loading=this.fetching;this.inform('loading',{loading:this.loading});}}.bind(this));};y.prototype.initEvents=function(){k.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var z={blur:r(this,'blur'),focus:r(this,'focus'),click:r(this,'click'),keyup:r(this,'keyup'),keydown:r(this,'keydown')};if(q.firefox())z.text=z.keyup;if(q.firefox()<4){z.keypress=z.keydown;delete z.keydown;}k.listen(this.element,z);k.listen(this.element,'keypress',r(this,'keypress'));};y.prototype.initToggle=function(){this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));};y.prototype.viewMousedown=function(){this.selecting=true;};y.prototype.viewMouseup=function(){this.selecting=false;};y.prototype.blur=function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');};y.prototype.click=function(){var z=n.get(this.element);if(z.start==z.end)this.element.select();this.inform('click');};y.prototype.focus=function(){this.checkValue();this.inform('focus');};y.prototype.keyup=function(){if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();if(this.getValue().length===0)this.inform('change',null);};y.prototype.keydown=function(event){if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(k.getKeyCode(event)){case o.TAB:this.handleTab(event);return;case o.UP:this.view.prev();break;case o.DOWN:this.view.next();break;case o.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();};y.prototype.keypress=function(event){if(this.view.getSelection()&&k.getKeyCode(event)==o.RETURN){this.view.select();event.kill();}};y.prototype.handleTab=function(event){if(this.preventFocusChangeOnTab)if(this.view.getSelection()){event.kill();}else event.prevent();this.view.select();};y.prototype.select=function(z){if(z&&this.setValueOnSelect){this.setValue(z.text);this.setHiddenValue(z.uid);this.selectedText=z.text;i.addClass(this.inputWrap,'selected');}};y.prototype.afterSelect=function(){this.keepFocused?l.set(this.element):this.element.blur();this.resetOnSelect?this.reset():this.view.reset();};y.prototype.unselect=function(){if(this.setValueOnSelect){this.selectedText=null;i.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);};y.prototype.setEnabled=function(z){var aa=z===false;this.element.disabled=aa;i.conditionClass(this.root,'uiTypeaheadDisabled',aa);};y.prototype.reset=function(){this.unselect();this.setValue();!this.keepFocused&&m.reset(this.element);this.view.reset();this.inform('reset');};y.prototype.getElement=function(){return this.element;};y.prototype.setExclusions=function(z){this._exclusions=z.map(String);};y.prototype.getExclusions=function(){return this._exclusions;};y.prototype.setValue=function(z){this.value=this.nextQuery=z||'';m.setValue(this.element,this.value);p.update(this.element);this.inform('change',z);};y.prototype.setHiddenValue=function(z){this.hiddenInput.value=(z||z===0)?z:'';g.inform('Form/change',{node:this.hiddenInput});};y.prototype.getValue=function(){return m.getValue(this.element);};y.prototype.getHiddenValue=function(){return this.hiddenInput.value||'';};y.prototype.checkValue=function(){var z=this.getValue();if(z==this.value)return;if(this.selectedText&&this.selectedText!=z)this.unselect();var aa=Date.now(),ba=aa-this.time;this.time=aa;this.value=this.nextQuery=z;this.performQuery(ba);};y.prototype.performQuery=function(z){if(this.selectedText)return;z=z||0;if(this.fetching&&z<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions,z);}else{this.data.query(this.nextQuery,false,this._exclusions,z);this.nextQuery=null;}};s(y.prototype,{events:['blur','focus','click','unselect','loading'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false});e.exports=y;});
__d("TypeaheadBestName",["TokenizeUtil","copyProperties"],function(a,b,c,d,e,f){var g=b('TokenizeUtil'),h=b('copyProperties');function i(j){this._typeahead=j;}i.prototype.enable=function(){var j=this._typeahead.getView();this._subscription=j.subscribe('beforeRender',function(k,l){var m=l.value;for(var n=0;n<l.results.length;++n){var o=l.results[n];if(o.alternate_names==null)continue;if(g.isQueryMatch(m,o.default_name)){o.text=o.default_name;return;}for(var p=0;p<o.alternate_names.length;p++)if(g.isQueryMatch(m,o.alternate_names[p])){o.text=o.alternate_names[p];return;}o.text=o.default_name;}});};i.prototype.disable=function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;};h(i.prototype,{_subscription:null});e.exports=i;});
__d("legacy:BestNameTypeaheadBehavior",["TypeaheadBestName"],function(a,b,c,d){var e=b('TypeaheadBestName');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.buildBestAvailableNames=function(f){f.enableBehavior(e);};},3);
__d("ClearableTypeahead",["Event"],function(a,b,c,d,e,f){var g=b('Event'),h={resetOnCloseButtonClick:function(i,j){g.listen(j,'click',function(){var k=i.getCore();k.getElement().focus();k.reset();});}};e.exports=h;});
__d("TypeaheadShowLoadingIndicator",["CSS","copyProperties"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('copyProperties');function i(j){this._typeahead=j;}i.prototype.enable=function(){this._subscription=this._typeahead.subscribe('loading',function(j,k){g.conditionClass(this._typeahead.getElement(),'typeaheadLoading',k.loading);g.conditionClass(this._typeahead.getView().getElement(),'typeaheadViewLoading',k.loading);}.bind(this));};i.prototype.disable=function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;};h(i.prototype,{_subscription:null});e.exports=i;});
__d("legacy:ShowLoadingIndicatorTypeaheadBehavior",["TypeaheadShowLoadingIndicator"],function(a,b,c,d){var e=b('TypeaheadShowLoadingIndicator');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.showLoadingIndicator=function(f){f.enableBehavior(e);};},3);
__d("CompactTypeaheadRenderer",["BadgeHelper","DOM","TypeaheadFacepile"],function(a,b,c,d,e,f){var g=b('BadgeHelper'),h=b('DOM'),i=b('TypeaheadFacepile');function j(k,l){var m=[];if(k.xhp)return h.create('li',{className:'raw'},k.xhp);var n=k.photos||k.photo;if(n){if(n instanceof Array){n=i.render(n);}else n=h.create('img',{alt:'',src:n});m.push(n);}if(k.text){var o=[k.text];if(k.verified)o.push(g.renderBadge('xsmall','verified'));m.push(h.create('span',{className:'text'},o));}var p=k.subtext,q=k.category;if(p||q){var r=[];p&&r.push(p);p&&q&&r.push(" \u00b7 ");q&&r.push(q);m.push(h.create('span',{className:'subtext'},r));}var s=h.create('li',{className:k.type||''},m);if(k.text)s.setAttribute('aria-label',k.text);return s;}j.className='compact';e.exports=j;});
__d("VaultBoxURI",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={PHOTOS_SYNCED:'photos_synced',isVaultBoxURI:function(i){var j=new RegExp("\/"+h.PHOTOS_SYNCED+"\/?$");return i.getPath().match(j)&&i.getQueryData().hasOwnProperty('view_image');},isVaultArchiveURI:function(i){var j=new RegExp("\/"+h.PHOTOS_SYNCED+"\/?$");return i.getPath().match(j);},getSyncedTabURI:function(){return new g('/me/'+h.PHOTOS_SYNCED).getQualifiedURI();}};e.exports=h;});